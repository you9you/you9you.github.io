<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>you9you的笔记本</title>
  
  <subtitle>一些简单的记录</subtitle>
  <link href="https://you9you.github.io/atom.xml" rel="self"/>
  
  <link href="https://you9you.github.io/"/>
  <updated>2025-05-13T10:00:59.000Z</updated>
  <id>https://you9you.github.io/</id>
  
  <author>
    <name>you9you</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>docker镜像digest验证脚本</title>
    <link href="https://you9you.github.io/20250511/docker-digest-validate/"/>
    <id>https://you9you.github.io/20250511/docker-digest-validate/</id>
    <published>2025-05-11T14:47:00.000Z</published>
    <updated>2025-05-13T10:00:59.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="主要目的"><a class="anchor" href="#主要目的">#</a> 主要目的</h2><p>防止镜像站或在传输的途中有人“加料”</p><h2 id="检测脚本deepseek-生成"><a class="anchor" href="#检测脚本deepseek-生成">#</a> 检测脚本（DeepSeek 生成）</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> docker</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> requests</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tqdm </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tqdm</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ============== 用户配置区域 ==============</span></span><span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">PROXIES</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 设置代理（若无代理则置空）</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">    "</span><span style="color:#B56959;--shiki-dark:#C98A7D">http</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">http://your-proxy:8080</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">    "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">http://your-proxy:8080</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ========================================</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> parse_repository</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parts </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> repo</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">split</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">/</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parts</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 检查是否是registry（包含.或:）</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">.</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#AB5959;--shiki-dark:#CB7676"> in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parts</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#AB5959;--shiki-dark:#CB7676"> or</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#AB5959;--shiki-dark:#CB7676"> in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parts</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        registry </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parts</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        remaining </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parts</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    else</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        registry </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">docker.io</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        remaining </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parts</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 处理剩余部分</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:#998418;--shiki-dark:#B8A965"> len</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">remaining</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ==</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> registry</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    elif</span><span style="color:#998418;--shiki-dark:#B8A965"> len</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">remaining</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ==</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        namespace </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">library</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        image </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> remaining</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    else</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        namespace </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">/</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">join</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">remaining</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#AB5959;--shiki-dark:#CB7676">-</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        image </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> remaining</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676">-</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> registry</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> namespace</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> image</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> get_auth_token</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repository</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    auth_url </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#AB5959;--shiki-dark:#CB7676"> f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"https://auth.docker.io/token?service=registry.docker.io&#x26;scope=repository:</span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repository</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">:pull"</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    try</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        response </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> requests</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">get</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">auth_url</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> proxies</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#A65E2B;--shiki-dark:#C99076">PROXIES</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        response</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">raise_for_status</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> response</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">json</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">get</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">token</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    except</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> requests</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">exceptions</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">RequestException </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> e</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"获取认证token失败：</span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> get_hub_digest</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repository</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tag</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    token </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> get_auth_token</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repository</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> token</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    headers </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">        '</span><span style="color:#B56959;--shiki-dark:#C98A7D">Authorization</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#AB5959;--shiki-dark:#CB7676"> f</span><span style="color:#B56959;--shiki-dark:#C98A7D">'Bearer </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">token</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">        '</span><span style="color:#B56959;--shiki-dark:#C98A7D">Accept</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">application/vnd.docker.distribution.manifest.v2+json</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    url </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#AB5959;--shiki-dark:#CB7676"> f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"https://registry-1.docker.io/v2/</span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repository</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">/manifests/</span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">tag</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    try</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        response </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> requests</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">head</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">url</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> headers</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">headers</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> proxies</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#A65E2B;--shiki-dark:#C99076">PROXIES</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        response</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">raise_for_status</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> response</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">headers</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">get</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">Docker-Content-Digest</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    except</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> requests</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">exceptions</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">RequestException </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> e</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"获取Docker Hub上的manifest失败：</span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> main</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    client </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> docker</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">from_env</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    images </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> client</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">images</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">list</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    result_pass </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    result_warn </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 使用tqdm添加进度条</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tqdm</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">total</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">len</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">images</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> desc</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">扫描镜像</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> unit</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">image</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> pbar</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> image </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> images</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            repoTags </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> image</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">attrs</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">get</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">RepoTags</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            repoDigests </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> image</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">attrs</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">get</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">RepoDigests</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            </span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> repo_tag </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> repoTags</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                # 更新进度条描述</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                pbar</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">set_postfix_str</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"正在检查：</span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91">30</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                </span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                if</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">@</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#AB5959;--shiki-dark:#CB7676"> in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> repo_tag</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    continue</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 跳过含digest的repo_tag</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                # 分割repository和tag</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                repo_tag_parts </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> repo_tag</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">rsplit</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                if</span><span style="color:#998418;--shiki-dark:#B8A965"> len</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag_parts</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ==</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                    repository</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tag </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> repo_tag_parts</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                else</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                    repository </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> repo_tag_parts</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                    tag </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">latest</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                # 解析repository</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                registry</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> namespace</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> image_name </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parse_repository</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repository</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> registry </span><span style="color:#AB5959;--shiki-dark:#CB7676">or</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> namespace </span><span style="color:#AB5959;--shiki-dark:#CB7676">or</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> image_name</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    continue</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                # 仅处理docker.io/library的官方镜像</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                #if registry == 'docker.io' and namespace == 'library':</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                # 仅处理docker.io的官方镜像</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                if</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> registry </span><span style="color:#AB5959;--shiki-dark:#CB7676">==</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">docker.io</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                    digest </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                    # 在repoDigests中查找匹配的digest</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> repoDigests</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                        if</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">@</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#AB5959;--shiki-dark:#CB7676"> in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                            continue</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                        repo_part</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> digest_part </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">split</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">@</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                        d_registry</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d_namespace</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d_image </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parse_repository</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_part</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                        if</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d_registry </span><span style="color:#AB5959;--shiki-dark:#CB7676">==</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> registry </span><span style="color:#AB5959;--shiki-dark:#CB7676">and</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d_namespace </span><span style="color:#AB5959;--shiki-dark:#CB7676">==</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> namespace </span><span style="color:#AB5959;--shiki-dark:#CB7676">and</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d_image </span><span style="color:#AB5959;--shiki-dark:#CB7676">==</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> image_name</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                            digest </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> digest_part</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                            break</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> digest</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">                        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"镜像 </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 没有找到对应的Repo Digest，跳过"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                        result_pass</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                        continue</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                    # 构建Docker Hub的仓库名</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                    hub_repo </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#AB5959;--shiki-dark:#CB7676"> f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">namespace</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">/</span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">image_name</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                    # 获取Docker Hub的digest</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                    hub_digest </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> get_hub_digest</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">hub_repo</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tag</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> hub_digest</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">                        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"无法获取 </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">hub_repo</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">:</span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">tag</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 的Docker Hub digest"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                        result_warn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"无法获取 </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">hub_repo</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">:</span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">tag</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 的Docker Hub digest"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                        continue</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                    # 比较digest</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> hub_digest </span><span style="color:#AB5959;--shiki-dark:#CB7676">==</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> digest</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">                        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"镜像 </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 的digest匹配"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    else</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">                        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"镜像 </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 的digest不匹配。本地: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">digest</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">, 远程: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">hub_digest</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                        result_warn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"镜像 </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 的digest不匹配"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                else</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">                    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"镜像 </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> registry </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">registry</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">，跳过"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                    result_pass</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">repo_tag</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            # 更新进度条</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            pbar</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">update</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            pbar</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">refresh</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">-</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#AB5959;--shiki-dark:#CB7676"> *</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 10</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">跳过</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#AB5959;--shiki-dark:#CB7676"> +</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">, </span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">join</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">result_pass</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#A65E2B;--shiki-dark:#C99076">\n</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">join</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">result_warn</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#998418;--shiki-dark:#B8A965"> __name__</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ==</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">__main__</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    main</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><h3 id="安装依赖"><a class="anchor" href="#安装依赖">#</a> 安装依赖</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">pip</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> docker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> requests</span><span style="color:#B56959;--shiki-dark:#C98A7D"> tqdm</span></span></code></pre><h3 id="运行效果"><a class="anchor" href="#运行效果">#</a> 运行效果</h3><p>执行脚本后，它将遍历本地所有Docker镜像，识别官方镜像，并对比本地与Docker Hub的Digest。<br />此脚本能够有效地检查本地官方镜像的Digest是否与Docker Hub一致，帮助确认镜像的完整性和更新状态。</p><h3 id="注意事项"><a class="anchor" href="#注意事项">#</a> 注意事项</h3><ul><li><p>认证限制：Docker Hub API有请求频率限制，频繁请求可能导致临时封禁。</p></li><li><p>网络连接：确保运行环境可以访问Docker Hub（可通过更改<code>PROXIES</code>来配置代理）。</p></li><li><p>官方镜像判断：脚本严格判断镜像属于<code>docker.io/library</code>仓库，其他仓库的镜像将被排除。</p></li><li><p>错误处理：脚本包含基础错误处理，但部分异常可能需要根据实际情况扩展。</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;主要目的&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#主要目的&quot;&gt;#&lt;/a&gt; 主要目的&lt;/h2&gt;
&lt;p&gt;防止镜像站或在传输的途中有人“加料”&lt;/p&gt;
&lt;h2 id=&quot;检测脚本deepseek-生成&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#检测脚</summary>
      
    
    
    
    
    <category term="docker" scheme="https://you9you.github.io/tags/docker/"/>
    
    <category term="python" scheme="https://you9you.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Kohya_ss因图片错误导致训练报错</title>
    <link href="https://you9you.github.io/20250416/kohya_ss_exception/"/>
    <id>https://you9you.github.io/20250416/kohya_ss_exception/</id>
    <published>2025-04-16T14:51:00.000Z</published>
    <updated>2025-04-26T13:21:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="可能出现的错误"><a class="anchor" href="#可能出现的错误">#</a> 可能出现的错误</h2><blockquote><p>OSError: image file is truncated (7 bytes not processed)</p></blockquote><blockquote><p>OSError: broken data stream when reading image file</p></blockquote><blockquote><p>OSError: image file is truncated (1 bytes not processed)</p></blockquote><h2 id="解决方案-预检测脚本"><a class="anchor" href="#解决方案-预检测脚本">#</a> 解决方案-预检测脚本</h2><h3 id="预检测脚本deepseek-生成"><a class="anchor" href="#预检测脚本deepseek-生成">#</a> 预检测脚本（DeepSeek 生成）</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> os</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#A65E2B;--shiki-dark:#C99076"> PIL</span><span style="color:#1E754F;--shiki-dark:#4D9375"> import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Image</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tqdm </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tqdm  </span><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 用于显示进度条，可选</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> check_image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">file_path</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    try</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Image</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">open</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">file_path</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> img</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            # 强制加载所有像素数据</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            img</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">load</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            # 进一步验证图像完整性（可选）</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            img</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">tobytes</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> True</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    except</span><span style="color:#998418;--shiki-dark:#B8A965"> OSError</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> e</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">truncated</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#AB5959;--shiki-dark:#CB7676"> in</span><span style="color:#998418;--shiki-dark:#B8A965"> str</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">            print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"损坏文件: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">file_path</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> - 错误信息: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#998418;--shiki-dark:#B8A965">str</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> False</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        else</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            # 其他类型的OSError也需要处理</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">            print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"无效文件: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">file_path</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> - 错误信息: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#998418;--shiki-dark:#B8A965">str</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> False</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    except</span><span style="color:#998418;--shiki-dark:#B8A965"> Exception</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> e</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"未知错误: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">file_path</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> - 错误类型: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#998418;--shiki-dark:#B8A965">type</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#998418;--shiki-dark:#B8A965">__name__</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">, 信息: </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#998418;--shiki-dark:#B8A965">str</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> False</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> scan_images_directory</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">directory</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    corrupted_files </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 支持常见图片格式</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    image_extensions </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">.jpg</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">.jpeg</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">.png</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">.webp</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">.bmp</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">.tiff</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 遍历目录</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> root</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> _</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> files </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> os</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">walk</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">directory</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        for</span><span style="color:#B07D48;--shiki-dark:#BD976A"> file</span><span style="color:#1E754F;--shiki-dark:#4D9375"> in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tqdm</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">files</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> desc</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">正在扫描文件</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:#998418;--shiki-dark:#B8A965"> any</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">file</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">lower</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">endswith</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ext</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ext </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> image_extensions</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                file_path </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> os</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">path</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">join</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">root</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> file</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> check_image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">file_path</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">                    corrupted_files</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">file_path</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 输出总结报告</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#A65E2B;--shiki-dark:#C99076">\n</span><span style="color:#B56959;--shiki-dark:#C98A7D">扫描完成！</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> corrupted_files</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"发现 </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#998418;--shiki-dark:#B8A965">len</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">corrupted_files</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 个损坏文件:"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> path </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> corrupted_files</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">            print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">" - </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">path</span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    else</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">未发现损坏文件</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#998418;--shiki-dark:#B8A965"> __name__</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ==</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">__main__</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> argparse</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    </span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parser </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> argparse</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ArgumentParser</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">description</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">检测损坏的图片文件</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">directory</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">str</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">要扫描的目录路径</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    args </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parse_args</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    </span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    scan_images_directory</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">directory</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><h3 id="安装依赖"><a class="anchor" href="#安装依赖">#</a> 安装依赖</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">pip</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> Pillow</span><span style="color:#B56959;--shiki-dark:#C98A7D"> tqdm</span></span></code></pre><h3 id="运行脚本"><a class="anchor" href="#运行脚本">#</a> 运行脚本</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> check_images.py</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">你的图片目录路</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">径</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;可能出现的错误&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#可能出现的错误&quot;&gt;#&lt;/a&gt; 可能出现的错误&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;OSError: image file is truncated (7 bytes not processe</summary>
      
    
    
    
    
    <category term="python" scheme="https://you9you.github.io/tags/python/"/>
    
    <category term="Kohya_ss" scheme="https://you9you.github.io/tags/Kohya-ss/"/>
    
    <category term="Stable Diffusion" scheme="https://you9you.github.io/tags/Stable-Diffusion/"/>
    
    <category term="AI" scheme="https://you9you.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>更新至Python 3.13导致的自签名CA出现[SSL CERTIFICATE_VERIFY_FAILED] certificate verify failed Missing Authority Key Identifier</title>
    <link href="https://you9you.github.io/20250106/python3.13_x509_strict/"/>
    <id>https://you9you.github.io/20250106/python3.13_x509_strict/</id>
    <published>2025-01-06T07:12:00.000Z</published>
    <updated>2025-01-06T07:28:34.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="更新至python-313导致的自签名ca出现ssl-certificate_verify_failed-certificate-verify-failed-missing-authority-key-identifier"><a class="anchor" href="#更新至python-313导致的自签名ca出现ssl-certificate_verify_failed-certificate-verify-failed-missing-authority-key-identifier">#</a> 更新至Python 3.13导致的自签名CA出现[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: Missing Authority Key Identifier</h1><h2 id="排查"><a class="anchor" href="#排查">#</a> 排查</h2><ul><li>查看<a href="https://docs.python.org/3/whatsnew/3.13.html#ssl">python更新日志</a></li><li>测试<code>x509_strict</code></li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">openssl</span><span style="color:#B56959;--shiki-dark:#C98A7D"> verify</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -x509_strict</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -CAfile</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /data/ca.crt</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /data/web/web1.crt</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># error 92 at 1 depth lookup: CA cert does not include key usage extension</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># error /data/web/web1.crt: verification failed</span></span></code></pre><h2 id="重新生成ca证书"><a class="anchor" href="#重新生成ca证书">#</a> 重新生成CA证书</h2><blockquote><p>重新根据ca.key生成ca.crt，只需替换ca.crt即可，已经颁发的证书仍正常使用。</p></blockquote><h3 id="复制一份-opensslcnf可选"><a class="anchor" href="#复制一份-opensslcnf可选">#</a> 复制一份 openssl.cnf（可选）</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> cp</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /etc/ssl/openssl.cnf</span><span style="color:#B56959;--shiki-dark:#C98A7D"> openssl_ca.cnf</span></span></code></pre><h3 id="调整-opensslcnf"><a class="anchor" href="#调整-opensslcnf">#</a> 调整 openssl.cnf</h3><p>编辑<code>openssl_ca.cnf</code>并将其中<code>[ v3_ca ]</code>下的<code>keyUsage = cRLSign, keyCertSign</code>解除注释</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> v3_ca </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Key usage: this is typical for a CA certificate. However since it will</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># prevent it being used as an test self-signed certificate it is best</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># left out by default.</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">keyUsage</span><span style="color:#B56959;--shiki-dark:#C98A7D"> =</span><span style="color:#B56959;--shiki-dark:#C98A7D"> cRLSign,</span><span style="color:#B56959;--shiki-dark:#C98A7D"> keyCertSign</span></span></code></pre><h3 id="生成证书请求文件csr已有csr可忽略"><a class="anchor" href="#生成证书请求文件csr已有csr可忽略">#</a> 生成证书请求文件csr（已有csr可忽略）</h3><p>生成证书请求文件csr，需要使用原<code>ca.crt</code>和<code>ca.key</code></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">openssl</span><span style="color:#B56959;--shiki-dark:#C98A7D"> x509</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -x509toreq</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -in</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ca.crt</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -signkey</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ca.key</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -out</span><span style="color:#B56959;--shiki-dark:#C98A7D"> new-ca.csr</span></span></code></pre><h3 id="生成ca证书"><a class="anchor" href="#生成ca证书">#</a> 生成ca证书</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">openssl</span><span style="color:#B56959;--shiki-dark:#C98A7D"> x509</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -req</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -days</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 3650</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -extfile</span><span style="color:#B56959;--shiki-dark:#C98A7D"> openssl_ca.cnf</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -extensions</span><span style="color:#B56959;--shiki-dark:#C98A7D"> v3_ca</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -in</span><span style="color:#B56959;--shiki-dark:#C98A7D"> new-ca.csr</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -signkey</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ca.key</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -out</span><span style="color:#B56959;--shiki-dark:#C98A7D"> new-ca.crt</span></span></code></pre><h2 id="测试"><a class="anchor" href="#测试">#</a> 测试</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">openssl</span><span style="color:#B56959;--shiki-dark:#C98A7D"> verify</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -x509_strict</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -CAfile</span><span style="color:#B56959;--shiki-dark:#C98A7D"> new-ca.crt</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /data/web/web1.crt</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># /data/web/web1.crt: OK</span></span></code></pre><h2 id="导入到系统可信ca可选"><a class="anchor" href="#导入到系统可信ca可选">#</a> 导入到系统可信CA（可选）</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> cp</span><span style="color:#B56959;--shiki-dark:#C98A7D"> new-ca.crt</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /usr/local/share/ca-certificates/</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> update-ca-certificates</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Updating certificates in /etc/ssl/certs...</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 0 added, 0 removed; done.</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Running hooks in /etc/ca-certificates/update.d...</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Processing triggers for ca-certificates-java (20240118) ...</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># done.</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># done.</span></span></code></pre><h2 id="参考"><a class="anchor" href="#参考">#</a> 参考</h2><p><a href="https://www.cnblogs.com/liweifeng888/p/18648432">https://www.cnblogs.com/liweifeng888/p/18648432</a><br /><a href="https://superuser.com/questions/738612/openssl-ca-keyusage-extension">https://superuser.com/questions/738612/openssl-ca-keyusage-extension</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;更新至python-313导致的自签名ca出现ssl-certificate_verify_failed-certificate-verify-failed-missing-authority-key-identifier&quot;&gt;&lt;a class=&quot;anchor&quot; h</summary>
      
    
    
    
    
    <category term="python" scheme="https://you9you.github.io/tags/python/"/>
    
    <category term="openssl" scheme="https://you9you.github.io/tags/openssl/"/>
    
    <category term="certificate" scheme="https://you9you.github.io/tags/certificate/"/>
    
    <category term="self-signed certificates" scheme="https://you9you.github.io/tags/self-signed-certificates/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统的人脸识别身份验证</title>
    <link href="https://you9you.github.io/20240515/howdy-face-unlock-linux/"/>
    <id>https://you9you.github.io/20240515/howdy-face-unlock-linux/</id>
    <published>2024-05-15T05:53:00.000Z</published>
    <updated>2024-05-15T06:27:47.860Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a class="anchor" href="#简介">#</a> 简介</h2><p><a href="https://github.com/boltgolt/howdy">Howdy</a> 为 Linux 提供 Windows Hello 风格的身份验证。<br />使用内置红外发射器和摄像头与面部识别相结合来证明您是谁。</p><p>使用中央身份验证系统 (PAM)，这可以在您需要密码的任何地方使用：登录、锁定屏幕、sudo、su 等。</p><h2 id="安装前提"><a class="anchor" href="#安装前提">#</a> 安装前提</h2><p>确保<code>pypi</code>和<code>github</code>访问正常</p><h2 id="安装ubuntu"><a class="anchor" href="#安装ubuntu">#</a> 安装(Ubuntu)</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> add-apt-repository</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ppa:boltgolt/howdy</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> apt</span><span style="color:#B56959;--shiki-dark:#C98A7D"> update</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> apt</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span></span></code></pre><blockquote><p>在安装过程中会有如下 3 个选项可供选择：<br />F：Fast 快速<br />B：Balanced 平衡<br />S：Securs 安全</p></blockquote><h2 id="查看所有摄像头设备"><a class="anchor" href="#查看所有摄像头设备">#</a> 查看所有摄像头设备</h2><blockquote><p>在大多数 Linux 系统中，<code>/dev/video*</code> 为摄像头设备。</p></blockquote><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ls</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /dev/video</span><span style="color:#A65E2B;--shiki-dark:#C99076">*</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># /dev/video0  /dev/video1  /dev/video2  /dev/video3</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># thinkbook中video0为红外相机</span></span></code></pre><h2 id="配置howdy"><a class="anchor" href="#配置howdy">#</a> 配置Howdy</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> config</span></span></code></pre><p>查找以<code>device_path</code>开头的行，将其改为<code>/dev/video0</code>或你摄像头的实际路径。</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">video</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ...</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># The path of the device to capture frames from</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Should be set automatically by an installer if your distro has one</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">device_path</span><span style="color:#B56959;--shiki-dark:#C98A7D"> =</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /dev/video0</span></span></code></pre><h2 id="添加面部模型记录"><a class="anchor" href="#添加面部模型记录">#</a> 添加面部模型记录</h2><p>通过以下命令将人脸与特定 username 用户相关联：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -U</span><span style="color:#B56959;--shiki-dark:#C98A7D"> username</span><span style="color:#B56959;--shiki-dark:#C98A7D"> add</span></span></code></pre><p>配置好后 Howdy 就会随系统启动而自动启动，你可以在下次登录时就自动通过人脸设别登录。<br />在其它要验证权限的时候，Howdy 也可以直接免密授权，例如执行 sudo 提权时。</p><h2 id="其他"><a class="anchor" href="#其他">#</a> 其他</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 添加面部模型记录</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> add</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -U</span><span style="color:#B56959;--shiki-dark:#C98A7D"> username</span><span style="color:#B56959;--shiki-dark:#C98A7D"> add</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 编辑配置</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> config</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 查看面部模型记录</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> list</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 删除指定 ID 的面部记录</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> remove</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">face_I</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">D</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 清除所有面部模型记录</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> clear</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 禁用 Howdy 功能</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> disable</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 启用 Howdy 功能</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> disable</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 保存快照</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> snapshot</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 测试摄像头是否能找到面部(Ctrl+C取消)</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> test</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 查看版本</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> howdy</span><span style="color:#B56959;--shiki-dark:#C98A7D"> version</span></span></code></pre><h2 id="错误"><a class="anchor" href="#错误">#</a> 错误</h2><h3 id="在添加面部模型时"><a class="anchor" href="#在添加面部模型时">#</a> 在添加面部模型时</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Traceback</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">most </span><span style="color:#B56959;--shiki-dark:#C98A7D">recent</span><span style="color:#B56959;--shiki-dark:#C98A7D"> call</span><span style="color:#B56959;--shiki-dark:#C98A7D"> last</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">  File</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">/usr/local/bin/howdy</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">,</span><span style="color:#B56959;--shiki-dark:#C98A7D"> line</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 95,</span><span style="color:#B56959;--shiki-dark:#C98A7D"> in</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">modul</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">    import</span><span style="color:#B56959;--shiki-dark:#C98A7D"> cli.add</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">  File</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">/usr/lib/security/howdy/cli/add.py</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">,</span><span style="color:#B56959;--shiki-dark:#C98A7D"> line</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 48,</span><span style="color:#B56959;--shiki-dark:#C98A7D"> in</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">modul</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">    face_encoder</span><span style="color:#B56959;--shiki-dark:#C98A7D"> =</span><span style="color:#B56959;--shiki-dark:#C98A7D"> dlib.face_recognition_model_v1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">path</span><span style="color:#B56959;--shiki-dark:#C98A7D"> +</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">/../dlib-data/dlib_face_recognition_resnet_model_v1.dat</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">RuntimeError:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> Unable</span><span style="color:#B56959;--shiki-dark:#C98A7D"> to</span><span style="color:#B56959;--shiki-dark:#C98A7D"> open</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /usr/lib/security/howdy/cli/../dlib-data/dlib_face_recognition_resnet_model_v1.dat</span><span style="color:#B56959;--shiki-dark:#C98A7D"> for</span><span style="color:#B56959;--shiki-dark:#C98A7D"> reading.</span></span></code></pre><blockquote><p>原因：因网络或其他问题导致的模型数据缺失</p></blockquote><blockquote><p>解决方法：重新安装模型数据</p></blockquote><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">cd</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /usr/lib/security/howdy/dlib-data</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">./install.sh</span></span></code></pre><h2 id="参考"><a class="anchor" href="#参考">#</a> 参考</h2><p><a href="https://www.sysgeek.cn/howdy-face-unlock-linux/">Howdy—适用于Linux系统的人脸识别身份验证，安装和配置指南</a><br /><a href="https://github.com/boltgolt/howdy/issues/666">RuntimeError: Unable to open /usr/lib/security/howdy/cli/../dlib-data/dlib_face_recognition_resnet_model_v1.dat for reading.</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;简介&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#简介&quot;&gt;#&lt;/a&gt; 简介&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/boltgolt/howdy&quot;&gt;Howdy&lt;/a&gt; 为 Linux 提供 Windows Hello 风格的</summary>
      
    
    
    
    
    <category term="python" scheme="https://you9you.github.io/tags/python/"/>
    
    <category term="howdy" scheme="https://you9you.github.io/tags/howdy/"/>
    
    <category term="linux" scheme="https://you9you.github.io/tags/linux/"/>
    
    <category term="opencv" scheme="https://you9you.github.io/tags/opencv/"/>
    
  </entry>
  
  <entry>
    <title>LibreOffice Merge</title>
    <link href="https://you9you.github.io/20240410/libreoffice-merge/"/>
    <id>https://you9you.github.io/20240410/libreoffice-merge/</id>
    <published>2024-04-10T02:13:41.000Z</published>
    <updated>2024-04-10T02:18:07.399Z</updated>
    
    <content type="html"><![CDATA[<h1 id="libreoffice-文档-合并"><a class="anchor" href="#libreoffice-文档-合并">#</a> LibreOffice 文档 合并</h1><h2 id="docx-pdf"><a class="anchor" href="#docx-pdf">#</a> *.docx -&gt; pdf</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># *.docx -> *.pdf</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">libreoffice</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --headless</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --convert-to</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pdf</span><span style="color:#A65E2B;--shiki-dark:#C99076"> *</span><span style="color:#B56959;--shiki-dark:#C98A7D">.docx</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># *.pdf -> final.pdf</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">pdfunite</span><span style="color:#A65E2B;--shiki-dark:#C99076"> *</span><span style="color:#B56959;--shiki-dark:#C98A7D">.pdf</span><span style="color:#B56959;--shiki-dark:#C98A7D"> final.pdf</span></span></code></pre><h2 id="jpg-pdf"><a class="anchor" href="#jpg-pdf">#</a> *.jpg -&gt; pdf</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># *.jpg -> *.pdf</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">libreoffice</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --headless</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --convert-to</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pdf</span><span style="color:#A65E2B;--shiki-dark:#C99076"> *</span><span style="color:#B56959;--shiki-dark:#C98A7D">.jpg</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># *.pdf -> final.pdf</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">pdfunite</span><span style="color:#A65E2B;--shiki-dark:#C99076"> *</span><span style="color:#B56959;--shiki-dark:#C98A7D">.pdf</span><span style="color:#B56959;--shiki-dark:#C98A7D"> final.pdf</span></span></code></pre><h2 id="参考"><a class="anchor" href="#参考">#</a> 参考</h2><p><a href="https://www.cnblogs.com/greenhui/p/13137749.html">使用 libreoffice 批量化转化文件为 .pdf 并合并</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;libreoffice-文档-合并&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#libreoffice-文档-合并&quot;&gt;#&lt;/a&gt; LibreOffice 文档 合并&lt;/h1&gt;
&lt;h2 id=&quot;docx-pdf&quot;&gt;&lt;a class=&quot;anchor&quot; href</summary>
      
    
    
    
    
    <category term="libreoffice" scheme="https://you9you.github.io/tags/libreoffice/"/>
    
    <category term="docx" scheme="https://you9you.github.io/tags/docx/"/>
    
  </entry>
  
  <entry>
    <title>更新Linux内核至 6.5 后无法启动 VirtualBox</title>
    <link href="https://you9you.github.io/20240116/linux6-5-vbox/"/>
    <id>https://you9you.github.io/20240116/linux6-5-vbox/</id>
    <published>2024-01-16T01:27:19.000Z</published>
    <updated>2024-01-18T01:30:28.603Z</updated>
    
    <content type="html"><![CDATA[<h1 id="更新linux内核至-65-后无法启动-virtualbox"><a class="anchor" href="#更新linux内核至-65-后无法启动-virtualbox">#</a> 更新Linux内核至 6.5 后无法启动 VirtualBox</h1><blockquote><p>kernel driver not installed</p></blockquote><h2 id="系统"><a class="anchor" href="#系统">#</a> 系统</h2><p>Ubuntu 22.04.3 LTS</p><h2 id="排查"><a class="anchor" href="#排查">#</a> 排查</h2><p>错误在更新至内核(<code>6.5.0-14-generic</code>)后出现的，尝试切换内核</p><p>切换至<code>6.2.0-39-generic</code>时正常</p><p>在<code>6.5.0-14-generic</code>中执行<code>modprobe vboxdrv</code>，发现<code>FATAL: Module vboxdrv not found. </code></p><p>在<code>6.2.0-39-generic</code>中执行<code>modinfo vboxdrv</code>，查看路径<code>filename:       /lib/modules/6.2.0-39-generic/misc/vboxdrv.ko</code></p><p>发现<code>/lib/modules/6.5.0-14-generic/misc/</code>不存在</p><p>查看vbox安装日志<code>cat /var/log/vbox-setup.log</code>，发现<code>/bin/sh: 1: gcc-12: not found</code></p><h2 id="尝试修复"><a class="anchor" href="#尝试修复">#</a> 尝试修复</h2><p>切换至<code>6.5.0-14-generic</code></p><p>安装gcc-12<code>sudo apt install gcc-12</code></p><p>重新安装vbox<code>sudo apt install --reinstall ./virtualbox-7.0_7.0.12-159484~Ubuntu~jammy_amd64.deb</code></p><p>查看模块</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">$</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ls</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /lib/modules/6.5.0-14-generic/misc/</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">vboxdrv.ko</span><span style="color:#B56959;--shiki-dark:#C98A7D">  vboxnetadp.ko</span><span style="color:#B56959;--shiki-dark:#C98A7D">  vboxnetflt.ko</span></span></code></pre><p>VirtualBox已恢复正常</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;更新linux内核至-65-后无法启动-virtualbox&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#更新linux内核至-65-后无法启动-virtualbox&quot;&gt;#&lt;/a&gt; 更新Linux内核至 6.5 后无法启动 VirtualBox&lt;/h1&gt;
</summary>
      
    
    
    
    
    <category term="linux" scheme="https://you9you.github.io/tags/linux/"/>
    
    <category term="virtualbox" scheme="https://you9you.github.io/tags/virtualbox/"/>
    
    <category term="ubuntu" scheme="https://you9you.github.io/tags/ubuntu/"/>
    
    <category term="vboxdrv" scheme="https://you9you.github.io/tags/vboxdrv/"/>
    
  </entry>
  
  <entry>
    <title>Duck DNS &amp; Let&#39;s Encrypt</title>
    <link href="https://you9you.github.io/20230520/Duck-DNS-Let-s-Encrypt/"/>
    <id>https://you9you.github.io/20230520/Duck-DNS-Let-s-Encrypt/</id>
    <published>2023-05-20T02:11:05.000Z</published>
    <updated>2023-07-20T03:03:44.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用duck-dns获取lets-encrypt证书"><a class="anchor" href="#使用duck-dns获取lets-encrypt证书">#</a> 使用Duck DNS获取Let's Encrypt证书</h1><h2 id="注册duck-dns"><a class="anchor" href="#注册duck-dns">#</a> 注册Duck DNS</h2><p><a href="https://www.duckdns.org/">https://www.duckdns.org/</a><br />略</p><h2 id="安装certbot"><a class="anchor" href="#安装certbot">#</a> 安装certbot</h2><h3 id="nginx服务器ubuntu"><a class="anchor" href="#nginx服务器ubuntu">#</a> nginx服务器(Ubuntu)</h3><h4 id="安装certbot-2"><a class="anchor" href="#安装certbot-2">#</a> 安装certbot</h4><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> apt</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> certbot</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> apt</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> python3-certbot-nginx</span></span></code></pre><h4 id="创建申请"><a class="anchor" href="#创建申请">#</a> 创建申请</h4><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> certbot</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --manual</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --preferred-challenges</span><span style="color:#B56959;--shiki-dark:#C98A7D"> dns</span><span style="color:#B56959;--shiki-dark:#C98A7D"> certonly</span></span></code></pre><p>后会有类似以下提示：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-txt"><span class="line"><span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><span class="line"><span>Please deploy a DNS TXT record under the name:</span></span><span class="line"><span></span></span><span class="line"><span>_acme-challenge.test.duckdns.org.</span></span><span class="line"><span></span></span><span class="line"><span>with the following value:</span></span><span class="line"><span></span></span><span class="line"><span>sz8QCaKoQBBO5pYqTIUIVr-twoQYaa5yYiWHfcuDDTo</span></span><span class="line"><span>    </span></span><span class="line"><span>Before continuing, verify the record is deployed.</span></span><span class="line"><span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><span class="line"><span>Press Enter to Continue</span></span></code></pre><h4 id="更改txt记录"><a class="anchor" href="#更改txt记录">#</a> 更改TXT记录</h4><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># curl https://www.duckdns.org/update?domains={YOURVALUE}&#x26;token={YOURVALUE}&#x26;txt={YOURVALUE}</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 也可以浏览器访问，回显"OK"</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">curl</span><span style="color:#B56959;--shiki-dark:#C98A7D"> https://www.duckdns.org/update?domains=test.duckdns.org</span><span style="color:#999999;--shiki-dark:#666666">&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A">token</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B56959;--shiki-dark:#C98A7D">00000000-0000-0000-0000-00000000000f</span><span style="color:#999999;--shiki-dark:#666666">&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A">txt</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B56959;--shiki-dark:#C98A7D">sz8QCaKoQBBO5pYqTIUIVr-twoQYaa5yYiWHfcuDDTo</span></span></code></pre><h4 id="继续申请"><a class="anchor" href="#继续申请">#</a> 继续申请</h4><p>按<code>Enter</code></p><h4 id="成功提示"><a class="anchor" href="#成功提示">#</a> 成功提示</h4><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-txt"><span class="line"><span>Successfully received certificate.</span></span><span class="line"><span>Certificate is saved at: /etc/letsencrypt/live/test.duckdns.org/fullchain.pem</span></span><span class="line"><span>Key is saved at:         /etc/letsencrypt/live/test.duckdns.org/privkey.pem</span></span><span class="line"><span>This certificate expires on 2023-08-18.</span></span><span class="line"><span>These files will be updated when the certificate renews.</span></span><span class="line"><span></span></span><span class="line"><span>NEXT STEPS:</span></span><span class="line"><span>- This certificate will not be renewed automatically. Autorenewal of --manual certificates requires the use of an authentication hook script (--manual-auth-hook) but one was not provided. To renew this certificate, repeat this same certbot command before the certificate's expiry date.</span></span><span class="line"><span></span></span><span class="line"><span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><span class="line"><span>If you like Certbot, please consider supporting our work by:</span></span><span class="line"><span> * Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate</span></span><span class="line"><span> * Donating to EFF:                    https://eff.org/donate-le</span></span><span class="line"><span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span></code></pre><p>证书：<code>/etc/letsencrypt/live/test.duckdns.org/fullchain.pem</code><br />私钥：<code>/etc/letsencrypt/live/test.duckdns.org/privkey.pem</code></p><h4 id="创建自动续签任务"><a class="anchor" href="#创建自动续签任务">#</a> 创建自动续签任务</h4><p>保存<code>certbot-auth-duckdns.sh</code></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#!/bin/bash</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Create: certbot certonly --manual --preferred-challenges dns-01 --email mail@domain.com -d laravel.run -d *.laravel.run --server https://acme-v02.api.letsencrypt.org/directory --manual-auth-hook /path/to/certbot-auth-duckdns.sh</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Renew:  certbot renew --manual-auth-hook /path/to/certbot-auth-duckdns.sh</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># https://github.com/al-one/certbot-auth-dnspod/</span></span><span class="line"></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">API_TOKEN</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">""</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -z</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">$API_TOKEN</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> then</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -f</span><span style="color:#B07D48;--shiki-dark:#BD976A"> $HOME</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">/.duckdns_token_</span><span style="color:#B07D48;--shiki-dark:#BD976A">$CERTBOT_DOMAIN</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666"> &#x26;&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> API_TOKEN</span><span style="color:#999999;--shiki-dark:#666666">=$</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">cat</span><span style="color:#B07D48;--shiki-dark:#BD976A"> $HOME</span><span style="color:#B56959;--shiki-dark:#C98A7D">/.duckdns_token_</span><span style="color:#B07D48;--shiki-dark:#BD976A">$CERTBOT_DOMAIN</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">fi</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -z</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">$API_TOKEN</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> then</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -f</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> /etc/duckdns_token_</span><span style="color:#B07D48;--shiki-dark:#BD976A">$CERTBOT_DOMAIN</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666"> &#x26;&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> API_TOKEN</span><span style="color:#999999;--shiki-dark:#666666">=$</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">cat</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /etc/duckdns_token_</span><span style="color:#B07D48;--shiki-dark:#BD976A">$CERTBOT_DOMAIN</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">fi</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -z</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">$API_TOKEN</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> then</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -f</span><span style="color:#B07D48;--shiki-dark:#BD976A"> $HOME</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">/.duckdns_token </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666"> &#x26;&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> API_TOKEN</span><span style="color:#999999;--shiki-dark:#666666">=$</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">cat</span><span style="color:#B07D48;--shiki-dark:#BD976A"> $HOME</span><span style="color:#B56959;--shiki-dark:#C98A7D">/.duckdns_token</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">fi</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -z</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">$API_TOKEN</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> then</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -f</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> /etc/duckdns_token </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666"> &#x26;&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> API_TOKEN</span><span style="color:#999999;--shiki-dark:#666666">=$</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">cat</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /etc/duckdns_token</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">fi</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -z</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">$API_TOKEN</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> then</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    API_TOKEN</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">$DUCKDNS_TOKEN</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">fi</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">echo</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#A65E2B;--shiki-dark:#C99076">\</span></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">DOMAIN: $CERTBOT_DOMAIN</span></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">VALIDATION:     $CERTBOT_VALIDATION</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># CERTBOT_DOMAIN: test.duckdns.org</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># VALIDATION:     ********</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># curl https://www.duckdns.org/update?domains=test.duckdns.org&#x26;token=00000000-0000-0000-0000-00000000000f&#x26;txt=sz8QCaKoQB</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">$1</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">clean</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> then</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    APIRET</span><span style="color:#999999;--shiki-dark:#666666">=$</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">curl</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -s</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://www.duckdns.org/update?domains=$CERTBOT_DOMAIN&#x26;token=$API_TOKEN&#x26;txt=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    echo</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">Remove Record: $CERTBOT_DOMAIN - $APIRET</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">else</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    APIRET</span><span style="color:#999999;--shiki-dark:#666666">=$</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">curl</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -s</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://www.duckdns.org/update?domains=$CERTBOT_DOMAIN&#x26;token=$API_TOKEN&#x26;txt=$CERTBOT_VALIDATION</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    echo</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">Update Record: $CERTBOT_DOMAIN - $APIRET</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # Sleep to make sure the change has time to propagate over to DNS</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">    sleep</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 30</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">fi</span></span></code></pre><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> crontab</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -e</span></span></code></pre><p>保持在线状态以免证书被吊销。在证书到期或续订之前不会执行任何操作。</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">0</span><span style="color:#A65E2B;--shiki-dark:#C99076"> *</span><span style="color:#B56959;--shiki-dark:#C98A7D">/12</span><span style="color:#A65E2B;--shiki-dark:#C99076"> *</span><span style="color:#A65E2B;--shiki-dark:#C99076"> *</span><span style="color:#A65E2B;--shiki-dark:#C99076"> *</span><span style="color:#B56959;--shiki-dark:#C98A7D"> export</span><span style="color:#B56959;--shiki-dark:#C98A7D"> DUCKDNS_TOKEN=00000000-0000-0000-0000-00000000000f</span><span style="color:#999999;--shiki-dark:#666666"> &#x26;&#x26;</span><span style="color:#59873A;--shiki-dark:#80A665"> python3</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -c</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">import random; import time; time.sleep(random.random() * 3600)</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666"> &#x26;&#x26;</span><span style="color:#59873A;--shiki-dark:#80A665"> certbot</span><span style="color:#B56959;--shiki-dark:#C98A7D"> renew</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --manual-auth-hook</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /path/to/certbot-auth-duckdns.sh</span></span></code></pre><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-txt"><span class="line"><span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><span class="line"><span>Processing /etc/letsencrypt/renewal/test.duckdns.org.conf</span></span><span class="line"><span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><span class="line"><span>Renewing an existing certificate for test.duckdns.org</span></span><span class="line"><span>Hook '--manual-auth-hook' for test.duckdns.org ran with output:</span></span><span class="line"><span> CERTBOT_DOMAIN: test.duckdns.org</span></span><span class="line"><span> VALIDATION:     sz8QCaKoQBBO5pYqTIUIVr-twoQYaa5yYiWHfcuDDTo</span></span><span class="line"><span> Update Record:  test.duckdns.org - OK</span></span><span class="line"><span></span></span><span class="line"><span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><span class="line"><span>Congratulations, all renewals succeeded: </span></span><span class="line"><span>  /etc/letsencrypt/live/test.duckdns.org/fullchain.pem (success)</span></span><span class="line"><span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><span class="line"><span></span></span></code></pre><h2 id="参考"><a class="anchor" href="#参考">#</a> 参考</h2><p><a href="https://opstrip.com/2018/12/28/Getting-Letsencrypt-Certificate-with-DNS-TXT/">Letsencrypt通过DNS的TXT记录来验证域名有效性</a><br /><a href="https://github.com/al-one/certbot-auth-dnspod/">Certbot DNS Authenticator For DNSPod</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;使用duck-dns获取lets-encrypt证书&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#使用duck-dns获取lets-encrypt证书&quot;&gt;#&lt;/a&gt; 使用Duck DNS获取Let&#39;s Encrypt证书&lt;/h1&gt;
&lt;h2 id=&quot;注册du</summary>
      
    
    
    
    
    <category term="https" scheme="https://you9you.github.io/tags/https/"/>
    
    <category term="nginx" scheme="https://you9you.github.io/tags/nginx/"/>
    
    <category term="ddns" scheme="https://you9you.github.io/tags/ddns/"/>
    
    <category term="curl" scheme="https://you9you.github.io/tags/curl/"/>
    
  </entry>
  
  <entry>
    <title>通过oauth2访问synapse服务</title>
    <link href="https://you9you.github.io/20230220/synapse-with-oauth/"/>
    <id>https://you9you.github.io/20230220/synapse-with-oauth/</id>
    <published>2023-02-20T08:22:25.000Z</published>
    <updated>2023-05-20T02:23:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a class="anchor" href="#环境">#</a> 环境</h1><h2 id="网络环境确保"><a class="anchor" href="#网络环境确保">#</a> 网络环境确保</h2><ul><li>https(建议,http未测试)</li><li>用户可访问<code>synapse</code>、<code>nextcloud</code></li><li><code>synapse</code>可访问<code>nextcloud</code></li></ul><h3 id="自签名证书问题指定ca文件"><a class="anchor" href="#自签名证书问题指定ca文件">#</a> 自签名证书问题(指定ca文件)</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># docker</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">-v</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /data/matrix/ca.pem:/etc/ssl/certs/ca.pem</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -e</span><span style="color:#B56959;--shiki-dark:#C98A7D"> SSL_CERT_FILE=/etc/ssl/certs/ca.pem</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># linux</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">export</span><span style="color:#B07D48;--shiki-dark:#BD976A"> SSL_CERT_FILE</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">/</span><span style="color:#B07D48;--shiki-dark:#BD976A">data</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">/</span><span style="color:#B07D48;--shiki-dark:#BD976A">matrix</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">/</span><span style="color:#B07D48;--shiki-dark:#BD976A">ca</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">pem</span></span></code></pre><h1 id="nextcloud"><a class="anchor" href="#nextcloud">#</a> nextcloud</h1><h2 id="在nextcloud创建oauth2-client"><a class="anchor" href="#在nextcloud创建oauth2-client">#</a> 在nextcloud创建OAuth2 Client</h2><p><a href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/oauth2.html">官方文档</a><br />callback: <code>https://&lt;Synapse Server&gt;/_synapse/client/oidc/callback</code></p><h2 id="synapse配置文件homeserveryaml"><a class="anchor" href="#synapse配置文件homeserveryaml">#</a> synapse配置文件(homeserver.yaml)</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-yaml"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># oidc选项</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">oidc_providers</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  -</span><span style="color:#998418;--shiki-dark:#B8A965"> idp_id</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> nextcloud</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    idp_name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> Nextcloud</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    #idp_brand: "net.eihei.mastodon"  # optional: styling hint for clients</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    discover</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> false</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    issuer</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ""</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    client_id</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> &#x3C;OAuth Client ID></span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    client_secret</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> &#x3C;OAuth Client Secret></span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    authorization_endpoint</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://&#x3C;Nextcloud Server>/apps/oauth2/authorize</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    token_endpoint</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://&#x3C;Nextcloud Server>/apps/oauth2/api/v1/token</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    userinfo_endpoint</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://&#x3C;Nextcloud Server>/ocs/v2.php/cloud/user?format=json</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    scopes</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> # nextcloud尚未实现此功能</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    user_mapping_provider</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">      config</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        subject_claim</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">ocs.data.id</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        localpart_template</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">&#x26;#123;&#x26;#123; ocs.data.id &#x26;#125;&#x26;#125;</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        display_name_template</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">&#x26;#123;&#x26;#123; ocs.data.display-name &#x26;#125;&#x26;#125;</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span></code></pre><h1 id="github"><a class="anchor" href="#github">#</a> github</h1><h2 id="在github创建oauth2-client"><a class="anchor" href="#在github创建oauth2-client">#</a> 在github创建OAuth2 Client</h2><p><a href="https://ruanyifeng.com/blog/2019/04/github-oauth.html">阮一峰的网络日志</a><br />callback: <code>https://&lt;Synapse Server&gt;/_synapse/client/oidc/callback</code></p><h2 id="synapse配置文件homeserveryaml-2"><a class="anchor" href="#synapse配置文件homeserveryaml-2">#</a> synapse配置文件(homeserver.yaml)</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-yaml"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># oidc选项</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">oidc_providers</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  -</span><span style="color:#998418;--shiki-dark:#B8A965"> idp_id</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> github</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    idp_name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> GitHub</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    idp_brand</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">github</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # optional: styling hint for clients</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    discover</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> false</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    issuer</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://github.com/</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    client_id</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> &#x3C;OAuth Client ID></span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    client_secret</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> &#x3C;OAuth Client Secret></span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    authorization_endpoint</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://github.com/login/oauth/authorize</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    token_endpoint</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://github.com/login/oauth/access_token</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    userinfo_endpoint</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">https://api.github.com/user</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    scopes</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">read:user</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    user_mapping_provider</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">      config</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        subject_claim</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">id</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        localpart_template</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">&#x26;#123;&#x26;#123; user.login &#x26;#125;&#x26;#125;</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        display_name_template</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">&#x26;#123;&#x26;#123; user.name &#x26;#125;&#x26;#125;</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span></code></pre><h1 id="其他"><a class="anchor" href="#其他">#</a> 其他</h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-yaml"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 禁用密码登录</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">password_config</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  enabled</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> false</span></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">sso_redirect_options</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  immediate</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> false</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  on_welcome_page</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> true</span></span></code></pre><p>OCS数据结构</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">    '</span><span style="color:#B56959;--shiki-dark:#C98A7D">ocs</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">        '</span><span style="color:#B56959;--shiki-dark:#C98A7D">meta</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">status</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">ok</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">statuscode</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 200</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">message</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">OK</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">        '</span><span style="color:#B56959;--shiki-dark:#C98A7D">data</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">storageLocation</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">id</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">youyou</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">lastLogin</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1676870000000</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">backend</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">Database</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">subadmin</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">Guest</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">quota</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">            </span><span style="color:#a13865;--shiki-dark:#d9739f">{</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">                '</span><span style="color:#B56959;--shiki-dark:#C98A7D">free</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">                '</span><span style="color:#B56959;--shiki-dark:#C98A7D">used</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">                '</span><span style="color:#B56959;--shiki-dark:#C98A7D">total</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">                '</span><span style="color:#B56959;--shiki-dark:#C98A7D">relative</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">                '</span><span style="color:#B56959;--shiki-dark:#C98A7D">quota</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -</span><span style="color:#2F798A;--shiki-dark:#4C9A91">3</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">            </span><span style="color:#a13865;--shiki-dark:#d9739f">}</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">avatarScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-federated</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">email</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">emailScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-federated</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">additional_mail</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">additional_mailScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">displaynameScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-federated</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">phone</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">phoneScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-local</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">address</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">addressScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-local</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">website</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">websiteScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-published</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">twitter</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">twitterScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-local</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">organisation</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">organisationScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-local</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">role</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">roleScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-local</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">headline</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">headlineScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-local</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">biography</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">biographyScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-local</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">profile_enabled</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">1</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">profile_enabledScope</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">v2-local</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">groups</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">language</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">zh_CN</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">locale</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">zh_Hans_CN</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">notify_email</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">backendCapabilities</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">            </span><span style="color:#a13865;--shiki-dark:#d9739f">{</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">                '</span><span style="color:#B56959;--shiki-dark:#C98A7D">setDisplayName</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> True</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">                '</span><span style="color:#B56959;--shiki-dark:#C98A7D">setPassword</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> True</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">            </span><span style="color:#a13865;--shiki-dark:#d9739f">}</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">            '</span><span style="color:#B56959;--shiki-dark:#C98A7D">display-name</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span></code></pre><h1 id="参考"><a class="anchor" href="#参考">#</a> 参考</h1><p><a href="https://candinya.com/posts/deploy-mastodon-with-synapse/">联合部署 Mastodon 与 Synapse | 糖菓·部落</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#环境&quot;&gt;#&lt;/a&gt; 环境&lt;/h1&gt;
&lt;h2 id=&quot;网络环境确保&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#网络环境确保&quot;&gt;#&lt;/a&gt; 网络环境确保&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;https(建议,</summary>
      
    
    
    
    
    <category term="synapse" scheme="https://you9you.github.io/tags/synapse/"/>
    
    <category term="oauth2" scheme="https://you9you.github.io/tags/oauth2/"/>
    
    <category term="nextcloud" scheme="https://you9you.github.io/tags/nextcloud/"/>
    
    <category term="github" scheme="https://you9you.github.io/tags/github/"/>
    
    <category term="element" scheme="https://you9you.github.io/tags/element/"/>
    
  </entry>
  
  <entry>
    <title>magisk钱包自封装教程</title>
    <link href="https://you9you.github.io/20230203/miui-eu-pay-magisk/"/>
    <id>https://you9you.github.io/20230203/miui-eu-pay-magisk/</id>
    <published>2023-02-03T06:17:00.000Z</published>
    <updated>2023-02-03T06:20:29.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>以 mix-4-odin-stable-V14.0.1.0.TKMCNXM 为例</p></blockquote><h1 id="下载"><a class="anchor" href="#下载">#</a> 下载</h1><ul><li><a href="https://xiaomirom.com/download/mix-4-odin-stable-V14.0.1.0.TKMCNXM/">国内ROM V14.0.1.0.TKMCNXM</a></li><li><a href="https://cdn.52huameng.com/software/MIUI%E5%9B%BD%E9%99%85%E7%89%88%E6%9C%AC%E5%9C%B0%E5%8C%96/%E5%9B%BD%E9%99%85%E7%89%88MIUI%E6%B7%BB%E5%8A%A0%E9%92%B1%E5%8C%85_Magisk%E6%A8%A1%E5%9D%97_%E6%A8%A1%E6%9D%BF_220630.zip">Magisk钱包模块模板</a></li><li><a href="https://github.com/ssut/payload-dumper-go/releases">payload.bin解包工具 payload-dumper-go</a></li></ul><h1 id="解包"><a class="anchor" href="#解包">#</a> 解包</h1><ul><li>将ROM解压并提取出文件里的<code>payload.bin</code></li><li>使用<code>payload-dumper-go</code>把<code>payload.bin</code>解包并提取出镜像文件(*.img)</li></ul><blockquote><p>钱包相关文件在product分区(其他版本可能在system分区)</p></blockquote><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">./payload-dumper-go</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -p</span><span style="color:#B56959;--shiki-dark:#C98A7D"> product</span><span style="color:#B56959;--shiki-dark:#C98A7D"> payload.bin</span></span></code></pre><ul><li>挂载提取出的镜像文件(windows可以使用Diskgenius挂载)</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">cd</span><span style="color:#B56959;--shiki-dark:#C98A7D"> extracted_</span><span style="color:#A65E2B;--shiki-dark:#C99076">*</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">mkdir</span><span style="color:#B56959;--shiki-dark:#C98A7D"> product</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> mount</span><span style="color:#B56959;--shiki-dark:#C98A7D"> product.img</span><span style="color:#B56959;--shiki-dark:#C98A7D"> product</span></span></code></pre><p>所需文件在<code>./product/app/</code></p><ul><li>复制<code>MINextpay</code> <code>MIpay</code> <code>MITSMClient</code> <code>UPTsmService</code>到<code>Magisk模块模板</code>压缩包的<code>/system/app/</code>下</li></ul><blockquote><p>不同版本的ROM文件名可能不一样</p></blockquote><h1 id="使用magisk安装"><a class="anchor" href="#使用magisk安装">#</a> 使用magisk安装</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;以 mix-4-odin-stable-V14.0.1.0.TKMCNXM 为例&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;下载&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#下载&quot;&gt;#&lt;/a&gt; 下载&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;</summary>
      
    
    
    
    
    <category term="magisk" scheme="https://you9you.github.io/tags/magisk/"/>
    
    <category term="miui" scheme="https://you9you.github.io/tags/miui/"/>
    
    <category term="eu" scheme="https://you9you.github.io/tags/eu/"/>
    
    <category term="pay" scheme="https://you9you.github.io/tags/pay/"/>
    
  </entry>
  
  <entry>
    <title>Jellyfin 无法获取媒体信息</title>
    <link href="https://you9you.github.io/20220614/jellyfin-unable-to-get-media-info/"/>
    <id>https://you9you.github.io/20220614/jellyfin-unable-to-get-media-info/</id>
    <published>2022-06-13T17:01:00.000Z</published>
    <updated>2022-06-14T10:08:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="现象"><a class="anchor" href="#现象">#</a> 现象</h2><ul><li>无法通过客户端直接播放，需要转码</li><li>字幕列表没有我添加的外部字幕</li></ul><h2 id="log"><a class="anchor" href="#log">#</a> Log</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>[2022-06-13 16:56:15.421 +00:00] [ERR] [56] MediaBrowser.Providers.Movies.MovieMetadataService: Error in "ffprobe"</span></span><span class="line"><span>MediaBrowser.Common.FfmpegException: ffprobe failed - streams and format are both null.</span></span><span class="line"><span>   at MediaBrowser.MediaEncoding.Encoder.MediaEncoder.GetMediaInfoInternal(String inputPath, String primaryPath, MediaProtocol protocol, Boolean extractChapters, String probeSizeArgument, Boolean isAudio, Nullable`1 videoType, Boolean forceEnableLogging, CancellationToken cancellationToken)</span></span><span class="line"><span>   at MediaBrowser.MediaEncoding.Encoder.MediaEncoder.GetMediaInfoInternal(String inputPath, String primaryPath, MediaProtocol protocol, Boolean extractChapters, String probeSizeArgument, Boolean isAudio, Nullable`1 videoType, Boolean forceEnableLogging, CancellationToken cancellationToken)</span></span><span class="line"><span>   at MediaBrowser.Providers.MediaInfo.MediaInfoResolver.GetExternalStreamsAsync(Video video, Int32 startIndex, IDirectoryService directoryService, Boolean clearCache, CancellationToken cancellationToken)</span></span><span class="line"><span>   at MediaBrowser.Providers.MediaInfo.FFProbeVideoInfo.AddExternalSubtitlesAsync(Video video, List`1 currentStreams, MetadataRefreshOptions options, CancellationToken cancellationToken)</span></span><span class="line"><span>   at MediaBrowser.Providers.MediaInfo.FFProbeVideoInfo.Fetch(Video video, CancellationToken cancellationToken, MediaInfo mediaInfo, BlurayDiscInfo blurayInfo, MetadataRefreshOptions options)</span></span><span class="line"><span>   at MediaBrowser.Providers.MediaInfo.FFProbeVideoInfo.ProbeVideo[T](T item, MetadataRefreshOptions options, CancellationToken cancellationToken)</span></span><span class="line"><span>   at MediaBrowser.Providers.Manager.MetadataService`2.RunCustomProvider(ICustomMetadataProvider`1 provider, TItemType item, String logName, MetadataRefreshOptions options, RefreshResult refreshResult, CancellationToken cancellationToken)</span></span><span class="line"><span>[2022-06-13 16:56:22.468 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: Starting Library Sync...</span></span><span class="line"><span>[2022-06-13 16:56:22.468 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: "LIBRARYSYNC" Added 0 items:  ""</span></span><span class="line"><span>[2022-06-13 16:56:22.591 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: "LIBRARYSYNC" Updated 1 items:  "b3542d63898d9493a047ab9ab041d76b"</span></span><span class="line"><span>[2022-06-13 16:56:22.591 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: "LIBRARYSYNC" Removed 0 items:  ""</span></span><span class="line"><span>[2022-06-13 16:56:22.591 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: Finished Library Sync Taking "00:00:00.1225482"</span></span></code></pre><h2 id="解决方案"><a class="anchor" href="#解决方案">#</a> 解决方案</h2><h3 id="清除缓存"><a class="anchor" href="#清除缓存">#</a> 清除缓存</h3><p>根据日志的标识查找文件&quot;b3542d63898d9493a047ab9ab041d76b&quot;</p><p><code>/jellyfin/config/metadata/library/b3/b3542d63898d9493a047ab9ab041d76b</code></p><p>将ass字幕文件删除</p><h3 id="调整字幕"><a class="anchor" href="#调整字幕">#</a> 调整字幕</h3><p>使用<code>Aegisub</code>格式化(另存文件即可)</p><h3 id="刷新"><a class="anchor" href="#刷新">#</a> 刷新</h3><p><code>刷新元数据</code>即可</p><h2 id="其他问题"><a class="anchor" href="#其他问题">#</a> 其他问题</h2><blockquote><p>16:9的视频四周都有黑边</p></blockquote><h3 id="网页版"><a class="anchor" href="#网页版">#</a> 网页版</h3><p>控制台-常规-品牌-自定义CSS代码</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-css"><span class="line"><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">htmlvideoplayer</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#998418;--shiki-dark:#B8A965">height</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#A65E2B;--shiki-dark:#C99076"> unset</span><span style="color:#1E754F;--shiki-dark:#4D9375">!important</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span></code></pre><h3 id="客户端jellyfin-media-player"><a class="anchor" href="#客户端jellyfin-media-player">#</a> 客户端(Jellyfin Media Player)</h3><p>设置-客户端设置-Video-Aspect</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>zoom</span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;现象&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#现象&quot;&gt;#&lt;/a&gt; 现象&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;无法通过客户端直接播放，需要转码&lt;/li&gt;
&lt;li&gt;字幕列表没有我添加的外部字幕&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;log&quot;&gt;&lt;a class=&quot;a</summary>
      
    
    
    
    
    <category term="jellyfin" scheme="https://you9you.github.io/tags/jellyfin/"/>
    
  </entry>
  
  <entry>
    <title>使用Sandboxie把Tencent关起来</title>
    <link href="https://you9you.github.io/20220325/sandboxie-tencent/"/>
    <id>https://you9you.github.io/20220325/sandboxie-tencent/</id>
    <published>2022-03-25T06:32:00.000Z</published>
    <updated>2022-03-25T06:02:27.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a class="anchor" href="#简介">#</a> 简介</h2><p><strong>Sandboxie</strong>是一个<a href="https://zh.wikipedia.org/wiki/%E6%B2%99%E7%9B%92_(%E9%9B%BB%E8%85%A6%E5%AE%89%E5%85%A8)">沙盒</a><a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F">计算机程序</a>，原先由Ronen Tzur开发，后被Invincea收购。Sandboxie可以在32位及64位的、基于<a href="https://zh.wikipedia.org/wiki/Windows_NT">Windows NT</a>的系统上执行（如<a href="https://zh.wikipedia.org/wiki/Windows_XP">Windows XP</a>、<a href="https://zh.wikipedia.org/wiki/Windows_7">Windows 7</a>等）。它创造了一个类似沙盒的独立作业环境，在其内部运行的程序并不能对硬盘产生永久性的影响。其为一个独立的虚拟环境，可用以测试不受信任的应用程序或上网行为。</p><h2 id="使用教程"><a class="anchor" href="#使用教程">#</a> 使用教程</h2><ol><li>安装<a href="https://github.com/sandboxie-plus/Sandboxie/releases">sandboxie-plus</a></li><li>进入微软应用商店网页版找到<a href="https://www.microsoft.com/zh-cn/p/qq%E6%A1%8C%E9%9D%A2%E7%89%88/9nhlgf0zwc5s">较为纯净的QQ</a>，并复制网址</li><li>进入<a href="https://store.rg-adguard.net/">应用下载站</a></li><li>粘贴网址并搜索</li><li>下载最大的appx文件(<s>Tencent软件最大的才是本体</s>)</li><li>使用解压软件打开(zip格式)</li><li>将里面的<code>QQ</code>复制到想放置的目录</li><li>在sandboxie-plus中新建沙盒</li><li>右键刚刚创建的沙盒<code>沙盒内容-&gt;创建快捷方式-&gt;所有文件和文件夹</code>，找到刚刚放置的QQ目录下的<code>\Bin\QQScLauncher.exe</code>并点击</li><li>从桌面快捷方式启动即可</li></ol><h2 id="注记"><a class="anchor" href="#注记">#</a> 注记</h2><p>使用教程以QQ为例，其他的产品如果没有<code>QQProtect.exe</code>之类需要管理员权限的流氓组件，可以直接在官网下载安装包，并使用sandboxie-plus运行安装程序，可以由<code>沙盒内容-&gt;创建快捷方式-&gt;桌面/程序</code>创建快捷方式</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;简介&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#简介&quot;&gt;#&lt;/a&gt; 简介&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Sandboxie&lt;/strong&gt;是一个&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E6%B2%99%E7%9</summary>
      
    
    
    
    
    <category term="sandboxie" scheme="https://you9you.github.io/tags/sandboxie/"/>
    
    <category term="tencent" scheme="https://you9you.github.io/tags/tencent/"/>
    
    <category term="qq" scheme="https://you9you.github.io/tags/qq/"/>
    
  </entry>
  
  <entry>
    <title>magisk隐藏root方案</title>
    <link href="https://you9you.github.io/20220324/magisk-hide/"/>
    <id>https://you9you.github.io/20220324/magisk-hide/</id>
    <published>2022-03-24T06:32:24.000Z</published>
    <updated>2022-03-24T17:11:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="起因"><a class="anchor" href="#起因">#</a> 起因</h2><p>Magisk作者，吴泓霖（John Wu）在他的个人推特上宣布，自己已加入Android平台安全团队，很高兴与曾经“on the other side”的人一起工作。</p><p>近日，吴泓霖在加入谷歌后首次发声，回应了外界关心的Magisk后续维护问题。他表示Magisk与Android确实有一定冲突，但Magisk项目将继续维护，也会参与社区工作，但他本人会受到谷歌的“额外审查”。</p><p>此外，MagiskHide将被取消，该功能可以让用户对App隐藏root权限，从而绕过某些App的root使用限制。吴泓霖表示，自己可以访问几乎所有的谷歌源代码，因此MagiskHide与在谷歌的工作存在利益冲突，因此只能停止该功能，但会保留一小部分基础功能。</p><p>用户将能够分配一个拒绝列表，其中Magisk拒绝进一步修改并恢复它所做的所有更改。Magisk不会 欺骗/改变/操纵 任何非Magisk相关的信号或跟踪来规避任何设备状态检测。</p><h2 id="解决方案"><a class="anchor" href="#解决方案">#</a> 解决方案</h2><p>Shamiko模块，由LSPosed开发团队开发的Magisk模块，能够在zygisk开启情况下，也可以使用MagiskHide。</p><p>在Magisk早期的版本中，MagiskHide可以让用户对App隐藏root权限，对于某些会检测root权限的App来说，这一功能十分有用。</p><p>但最近发布的新版Magisk中增加了名为Zygisk的新功能，就再也无法像以前一样隐藏root了，而Shamiko模块就可以实现在Zygisk开启情况下也能用的MagiskHide</p><h2 id="使用教程"><a class="anchor" href="#使用教程">#</a> 使用教程</h2><ol><li>在magisk设置里，<code>开启Zygisk</code></li><li>安装<a href="https://github.com/LSPosed/LSPosed.github.io/releases">Shamiko模块</a></li><li>通过<code>配置排除列表</code>选择需要隐藏的进程</li><li>配置好之后，<strong>关闭</strong><code>遵守排除列表</code>（开启会导致模块不会对列表生效）</li><li>重启系统即可</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;起因&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#起因&quot;&gt;#&lt;/a&gt; 起因&lt;/h2&gt;
&lt;p&gt;Magisk作者，吴泓霖（John Wu）在他的个人推特上宣布，自己已加入Android平台安全团队，很高兴与曾经“on the other side”的人一起工作</summary>
      
    
    
    
    
    <category term="magisk" scheme="https://you9you.github.io/tags/magisk/"/>
    
  </entry>
  
  <entry>
    <title>java, python互相兼容的chacha20-poly1305</title>
    <link href="https://you9you.github.io/20220317/chacha20-poly1305/"/>
    <id>https://you9you.github.io/20220317/chacha20-poly1305/</id>
    <published>2022-03-17T09:03:31.000Z</published>
    <updated>2022-03-25T11:31:04.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a class="anchor" href="#简介">#</a> 简介</h1><h2 id="chacha20"><a class="anchor" href="#chacha20">#</a> ChaCha20</h2><p><code>ChaCha</code>系列流密码，作为<code>Salsa20</code>密码的改良版，具有更强的抵抗密码分析攻击的特性，<code>20</code>表示该算法有20轮的加密计算。</p><p>由于是流密码，故以字节为单位进行加密，安全性的关键体现在密钥流生成的过程，即所依赖的<code>伪随机数</code>生成器（PRNG）的强度，加密过程即是将密钥流与明文逐字节异或得到密文，反之，解密是将密文再与密钥流做一次异或运算得到明文。</p><h2 id="poly1305消息认证码"><a class="anchor" href="#poly1305消息认证码">#</a> Poly1305消息认证码</h2><p><code>消息认证码</code>（带密钥的<code>Hash函数</code>）:密码学中，通信实体双方使用的一种验证机制，保证消息<code>数据完整性</code>的一种工具。构造方法由<em>M.Bellare</em>提出，安全性依赖于Hash函数，故也称带密钥的Hash函数。消息认证码是基于密钥和消息摘要所获得的一个值，可用于数据源发认证和完整性校验。</p><p><code>Poly1305</code>是<em>Daniel.J.Bernstein</em>创建的消息认证码，可用于检测消息的完整性和验证消息的真实性，现常在网络安全协议（SSL/TLS）中与<code>Salsa20</code>或<code>ChaCha20</code>流密码结合使用。</p><p><code>Poly1305</code>消息认证码的输入为32字节（256bit）的密钥和任意长度的消息比特流，经过一系列计算生成16字节（128bit）的摘要。</p><h1 id="源代码"><a class="anchor" href="#源代码">#</a> 源代码</h1><h2 id="java"><a class="anchor" href="#java">#</a> java</h2><blockquote><p>crypto库默认加密后的结构为 ciphertext + tag</p></blockquote><p><em><strong>ChaCha20Poly1305.java</strong></em></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-java"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">io</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">IOException</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">util</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">HashMap</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">util</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Map</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">security</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">GeneralSecurityException</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">security</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">InvalidAlgorithmParameterException</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">security</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">InvalidKeyException</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">security</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">NoSuchAlgorithmException</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">security</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">SecureRandom</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">security</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">spec</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">AlgorithmParameterSpec</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> javax</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">crypto</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Cipher</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> javax</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">crypto</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">KeyGenerator</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> javax</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">crypto</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">NoSuchPaddingException</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> javax</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">crypto</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">spec</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">IvParameterSpec</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> javax</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">crypto</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">spec</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">SecretKeySpec</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> class</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> ChaCha20Poly1305</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    private</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#AB5959;--shiki-dark:#CB7676"> final</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> String</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ENCRYPT_ALGO</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">ChaCha20-Poly1305/None/NoPadding</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Map</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#AB5959;--shiki-dark:#CB7676">String</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> Object</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#59873A;--shiki-dark:#80A665"> encrypt</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> plaintext</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> String </span><span style="color:#B07D48;--shiki-dark:#BD976A">header</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            throws</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> GeneralSecurityException</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> IOException </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nonceBytes</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">12</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        new</span><span style="color:#59873A;--shiki-dark:#80A665"> SecureRandom</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">nextBytes</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nonceBytes</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> data</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> encrypt</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">plaintext</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nonceBytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Utils</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">hex2bytes</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">header</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        Map</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#AB5959;--shiki-dark:#CB7676">String</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> Object</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#B07D48;--shiki-dark:#BD976A"> jsonMap</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> HashMap</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">        jsonMap</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">put</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">nonce</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Utils</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">bytes2hex</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nonceBytes</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">        jsonMap</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">put</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">header</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Utils</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">bytes2hex</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">header</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getBytes</span><span style="color:#bda437;--shiki-dark:#e6cc77">(</span><span style="color:#bda437;--shiki-dark:#e6cc77">)</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">        jsonMap</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">put</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">data</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Utils</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">bytes2hex</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> jsonMap</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> String </span><span style="color:#59873A;--shiki-dark:#80A665">decrypt2String</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nonce</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> AAD</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> cipherData</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> key</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            throws</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> GeneralSecurityException</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> IOException </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> decryptedText</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> decrypt</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cipherData</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nonce</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> AAD</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> String</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">decryptedText</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#59873A;--shiki-dark:#80A665"> decrypt2Bytes</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nonce</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> AAD</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> cipherData</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> key</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            throws</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> GeneralSecurityException</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> IOException </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> decryptedText</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> decrypt</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cipherData</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nonce</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> AAD</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> decryptedText</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#59873A;--shiki-dark:#80A665"> encrypt</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> plaintext</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nonceBytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> AAD</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            throws</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> GeneralSecurityException</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> IOException </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        try</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Get Cipher Instance</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            Cipher</span><span style="color:#B07D48;--shiki-dark:#BD976A"> cipher</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getInstance</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ENCRYPT_ALGO</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Create IvParamterSpec</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            AlgorithmParameterSpec</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ivParameterSpec</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> IvParameterSpec</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nonceBytes</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Create SecretKeySpec</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            SecretKeySpec</span><span style="color:#B07D48;--shiki-dark:#BD976A"> keySpec</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> SecretKeySpec</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ENCRYPT_ALGO</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Initialize Cipher for ENCRYPT_MODE</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">init</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">Cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">ENCRYPT_MODE</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> keySpec</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ivParameterSpec</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">updateAAD</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">AAD</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Perform Encryption</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            byte</span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> cipherText</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">doFinal</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">plaintext</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> cipherText</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#1E754F;--shiki-dark:#4D9375"> catch</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">NoSuchAlgorithmException </span><span style="color:#999999;--shiki-dark:#666666">|</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> NoSuchPaddingException </span><span style="color:#B07D48;--shiki-dark:#BD976A">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            throw</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> IllegalStateException</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#1E754F;--shiki-dark:#4D9375"> catch</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">InvalidKeyException </span><span style="color:#999999;--shiki-dark:#666666">|</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> InvalidAlgorithmParameterException </span><span style="color:#B07D48;--shiki-dark:#BD976A">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            throw</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> IllegalArgumentException</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#59873A;--shiki-dark:#80A665"> decrypt</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> cipherText</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nonceBytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> AAD</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            throws</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> GeneralSecurityException</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> IOException </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        try</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Get Cipher Instance</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            Cipher</span><span style="color:#B07D48;--shiki-dark:#BD976A"> cipher</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getInstance</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ENCRYPT_ALGO</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Create IvParamterSpec</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            AlgorithmParameterSpec</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ivParameterSpec</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> IvParameterSpec</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nonceBytes</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Create SecretKeySpec</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            SecretKeySpec</span><span style="color:#B07D48;--shiki-dark:#BD976A"> keySpec</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> SecretKeySpec</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ENCRYPT_ALGO</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Initialize Cipher for DECRYPT_MODE</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">init</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">Cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">DECRYPT_MODE</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> keySpec</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ivParameterSpec</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">updateAAD</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">AAD</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">            // Perform Decryption</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            byte</span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> decryptedText</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">doFinal</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cipherText</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> decryptedText</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#1E754F;--shiki-dark:#4D9375"> catch</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">NoSuchAlgorithmException </span><span style="color:#999999;--shiki-dark:#666666">|</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> NoSuchPaddingException </span><span style="color:#B07D48;--shiki-dark:#BD976A">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            throw</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> IllegalStateException</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#1E754F;--shiki-dark:#4D9375"> catch</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">InvalidKeyException </span><span style="color:#999999;--shiki-dark:#666666">|</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> InvalidAlgorithmParameterException </span><span style="color:#B07D48;--shiki-dark:#BD976A">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            throw</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> IllegalArgumentException</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    /**</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * 生成ChaCha20密钥(256bit)</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@return</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@throws</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> NoSuchAlgorithmException</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     */</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#59873A;--shiki-dark:#80A665"> generateKey</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> throws</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> NoSuchAlgorithmException </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        KeyGenerator</span><span style="color:#B07D48;--shiki-dark:#BD976A"> keyGen</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> KeyGenerator</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getInstance</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ENCRYPT_ALGO</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">        keyGen</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">init</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">256</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> SecureRandom</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getInstanceStrong</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#B07D48;--shiki-dark:#BD976A"> keyGen</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">generateKey</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getEncoded</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    /**</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * 测试</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@throws</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Exception</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     */</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">@</span><span style="color:#AB5959;--shiki-dark:#CB7676">Test</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> void</span><span style="color:#59873A;--shiki-dark:#80A665"> ChaCha20Poly1305Test</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> throws</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Exception </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        String</span><span style="color:#B07D48;--shiki-dark:#BD976A"> plaintext</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">ChaCha20Poly1305Test</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        KeyGenerator</span><span style="color:#B07D48;--shiki-dark:#BD976A"> keyGen</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> KeyGenerator</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getInstance</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">ChaCha20</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">        keyGen</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">init</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">256</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> SecureRandom</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getInstanceStrong</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        SecretKey</span><span style="color:#B07D48;--shiki-dark:#BD976A"> key</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> keyGen</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">generateKey</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nonceBytes</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">12</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        new</span><span style="color:#59873A;--shiki-dark:#80A665"> SecureRandom</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">nextBytes</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nonceBytes</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> AAD</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Utils</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">hex2bytes</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">Utils</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">md5</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">header</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ciphertext</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ChaCha20Poly1305</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">encrypt</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">plaintext</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getBytes</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> key</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getEncoded</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nonceBytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> AAD</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        String</span><span style="color:#B07D48;--shiki-dark:#BD976A"> text</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ChaCha20Poly1305</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">decrypt2String</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ciphertext</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> key</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getEncoded</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nonceBytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> AAD</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        assertEquals</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">plaintext</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> text</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">     </span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span></code></pre><p><em><strong>Utils.java</strong></em></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-java"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">math</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">BigInteger</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> java</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">security</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">MessageDigest</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> class</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Utils</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> String </span><span style="color:#59873A;--shiki-dark:#80A665">md5</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">String </span><span style="color:#B07D48;--shiki-dark:#BD976A">content</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> hash</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        try</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            hash </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B07D48;--shiki-dark:#BD976A"> MessageDigest</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getInstance</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">MD5</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">digest</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">content</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">getBytes</span><span style="color:#bda437;--shiki-dark:#e6cc77">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">utf-8</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#bda437;--shiki-dark:#e6cc77">)</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#1E754F;--shiki-dark:#4D9375"> catch</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Exception </span><span style="color:#B07D48;--shiki-dark:#BD976A">e</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            throw</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> RuntimeException</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">NoSuchAlgorithmException</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> e</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#59873A;--shiki-dark:#80A665"> bytes2hex</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">hash</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    /**</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@param</span><span style="color:#B07D48;--shiki-dark:#BD976A"> bytes</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> the byte []</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@return</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> the hex string</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     */</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> String </span><span style="color:#59873A;--shiki-dark:#80A665">bytes2hex</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> bytes</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#59873A;--shiki-dark:#80A665"> BigInteger</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> bytes</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">toString</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">16</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    /**</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * To byte array byte [ ].</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     *</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@param</span><span style="color:#B07D48;--shiki-dark:#BD976A"> hexString</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> the hex string</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@return</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> the byte []</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     */</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#59873A;--shiki-dark:#80A665"> hex2bytes</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">String </span><span style="color:#B07D48;--shiki-dark:#BD976A">hex</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        hex </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B07D48;--shiki-dark:#BD976A"> hex</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">length</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> %</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#AB5959;--shiki-dark:#CB7676"> !=</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#1E754F;--shiki-dark:#4D9375"> ?</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">0</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#AB5959;--shiki-dark:#CB7676"> +</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> hex </span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> hex</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> b</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#B07D48;--shiki-dark:#BD976A">hex</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">length</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> /</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        for</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">int</span><span style="color:#B07D48;--shiki-dark:#BD976A"> i</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> i </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> b</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">length</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> i</span><span style="color:#AB5959;--shiki-dark:#CB7676">++</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            int</span><span style="color:#B07D48;--shiki-dark:#BD976A"> index</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> i </span><span style="color:#AB5959;--shiki-dark:#CB7676">*</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            int</span><span style="color:#B07D48;--shiki-dark:#BD976A"> v</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Integer</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">parseInt</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">hex</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">substring</span><span style="color:#bda437;--shiki-dark:#e6cc77">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">index</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> index </span><span style="color:#AB5959;--shiki-dark:#CB7676">+</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#bda437;--shiki-dark:#e6cc77">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 16</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">            b</span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">i</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">byte</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> v</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">        </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> b</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    /**</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * 合并数组 System.arraycopy()</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@param</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte1</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@param</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte2</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     * </span><span style="color:#1E754F;--shiki-dark:#4D9375">@return</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">     */</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    public</span><span style="color:#AB5959;--shiki-dark:#CB7676"> static</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#59873A;--shiki-dark:#80A665"> byteMerger</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte2</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte3</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> new</span><span style="color:#AB5959;--shiki-dark:#CB7676"> byte</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#B07D48;--shiki-dark:#BD976A">byte1</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">length</span><span style="color:#AB5959;--shiki-dark:#CB7676"> +</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte2</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">length</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">        System</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">arraycopy</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">byte1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> byte3</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte1</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">length</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">        System</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">arraycopy</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">byte2</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> byte3</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte1</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">length</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte2</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">length</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> byte3</span><span style="color:#999999;--shiki-dark:#666666">;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span><span class="line"></span></code></pre><h2 id="python"><a class="anchor" href="#python">#</a> python</h2><blockquote><p>pycryptodome库默认加密后的结构为 ciphertext, tag</p></blockquote><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># pip install pycryptodome</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Crypto</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Cipher </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ChaCha20_Poly1305</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Crypto</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Random </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> get_random_bytes</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> chacha20_poly1305_en_func</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">plaintext</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> bytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> key</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> bytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> associatedData</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> bytes</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    #header = b"header"</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    #plaintext = b'Attack at dawn'</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    #key = get_random_bytes(32)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    cipher </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ChaCha20_Poly1305</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">new</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">key</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">key</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">update</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">associatedData</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    ciphertext</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tag </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">encrypt_and_digest</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">plaintext</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nonce</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">hex</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ciphertext </span><span style="color:#AB5959;--shiki-dark:#CB7676">+</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tag</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">hex</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> chacha20_poly1305_de_func</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ciphertext</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> bytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> key</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> bytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nonce</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> bytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> associatedData</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> bytes</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tag</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> bytes</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    cipher </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ChaCha20_Poly1305</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">new</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">key</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">key</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nonce</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nonce</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">update</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">associatedData</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    plaintext </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> cipher</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">decrypt_and_verify</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ciphertext</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> tag</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> plaintext</span></span></code></pre><h1 id="注记"><a class="anchor" href="#注记">#</a> 注记</h1><p>加密库处理结果为byte/byte[]，需要编码/解码（base64/hex）才能互相识别</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;简介&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#简介&quot;&gt;#&lt;/a&gt; 简介&lt;/h1&gt;
&lt;h2 id=&quot;chacha20&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#chacha20&quot;&gt;#&lt;/a&gt; ChaCha20&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Cha</summary>
      
    
    
    
    
    <category term="chacha20-poly1305" scheme="https://you9you.github.io/tags/chacha20-poly1305/"/>
    
  </entry>
  
  <entry>
    <title>通过隧道使用受限网络的思路</title>
    <link href="https://you9you.github.io/20220203/tunnel/"/>
    <id>https://you9you.github.io/20220203/tunnel/</id>
    <published>2022-02-03T13:53:00.000Z</published>
    <updated>2022-03-24T07:17:33.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="wireguard"><a class="anchor" href="#wireguard">#</a> <a href="https://www.wireguard.com/">WireGuard</a></h2><blockquote><p><strong>WireGuard</strong>是由Jason A. Donenfeld开发的<a href="https://zh.wikipedia.org/wiki/%E5%BC%80%E6%94%BE%E6%BA%90%E4%BB%A3%E7%A0%81">开放源代码</a><a href="https://zh.wikipedia.org/wiki/%E8%99%9B%E6%93%AC%E7%A7%81%E4%BA%BA%E7%B6%B2%E8%B7%AF">VPN</a>程序及协议，基于<a href="https://zh.wikipedia.org/wiki/Linux%E5%86%85%E6%A0%B8">Linux内核</a>实现，利用<a href="https://zh.wikipedia.org/wiki/Curve25519">Curve25519</a>进行密钥交换，<a href="https://zh.wikipedia.org/wiki/ChaCha20">ChaCha20</a>用于加密，<a href="https://zh.wikipedia.org/wiki/Poly1305">Poly1305</a>用于数据认证，<a href="https://zh.wikipedia.org/wiki/BLAKE2">BLAKE2</a>用于<a href="https://zh.wikipedia.org/wiki/%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B8">散列函数</a>运算，支持<a href="https://zh.wikipedia.org/wiki/IPv4">IPv4</a>和<a href="https://zh.wikipedia.org/wiki/IPv6">IPv6</a>的第3层。WireGuard旨在获得比<a href="https://zh.wikipedia.org/wiki/IPsec">IPsec</a>和<a href="https://zh.wikipedia.org/wiki/OpenVPN">OpenVPN</a>更好的性能。</p></blockquote><p>由于具有较高的性能，在没有任何检测机制的网络下，可以具有较高的体验</p><h2 id="openvpn"><a class="anchor" href="#openvpn">#</a> <a href="https://openvpn.net/">OpenVPN</a></h2><blockquote><p><strong>OpenVPN</strong>是一个用于创建<a href="https://zh.wikipedia.org/wiki/%E8%99%9A%E6%8B%9F%E7%A7%81%E4%BA%BA%E7%BD%91%E7%BB%9C">虚拟私人网络</a>加密通道的软件包，最早由James Yonan编写。OpenVPN允许创建的VPN使用<a href="https://zh.wikipedia.org/wiki/%E5%85%AC%E5%BC%80%E5%AF%86%E9%92%A5">公开密钥</a>、<a href="https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%AD%90%E8%AD%89%E6%9B%B8">电子证书</a>、或者用户名／密码来进行身份验证。</p><p>它大量使用了<a href="https://zh.wikipedia.org/wiki/OpenSSL">OpenSSL</a>加密库中的<a href="https://zh.wikipedia.org/wiki/SSL">SSL</a>/<a href="https://zh.wikipedia.org/wiki/TLS">TLS</a>协议函数库。</p><p>目前OpenVPN能在<a href="https://zh.wikipedia.org/wiki/Solaris">Solaris</a>、<a href="https://zh.wikipedia.org/wiki/Linux">Linux</a>、<a href="https://zh.wikipedia.org/wiki/OpenBSD">OpenBSD</a>、<a href="https://zh.wikipedia.org/wiki/FreeBSD">FreeBSD</a>、<a href="https://zh.wikipedia.org/wiki/NetBSD">NetBSD</a>、<a href="https://zh.wikipedia.org/wiki/Mac_OS_X">Mac OS X</a>与<a href="https://zh.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows</a>以及<a href="https://zh.wikipedia.org/wiki/Android">Android</a>和<a href="https://zh.wikipedia.org/wiki/IOS">iOS</a>上运行，并包含了许多安全性的功能。它不与<a href="https://zh.wikipedia.org/wiki/IPsec">IPsec</a>兼容。</p></blockquote><p>通过<a href="https://www.softether.org/">SoftEther VPN Project</a>是一个支持多协议的服务软件，可以快速的搭建服务</p><p>并且可以在只允许dns(udp/53)数据通过的情况下使用</p><h2 id="shadowsocks"><a class="anchor" href="#shadowsocks">#</a> <a href="https://shadowsocks.org/">Shadowsocks</a></h2><blockquote><p><strong>Shadowsocks</strong>（简称<strong>SS</strong>）是一种基于<a href="https://zh.wikipedia.org/wiki/SOCKS#SOCK5">Socks5</a>代理方式的加密传输协议，也可以指实现这个协议的各种开发包。目前包使用<a href="https://zh.wikipedia.org/wiki/Python">Python</a>、<a href="https://zh.wikipedia.org/wiki/C%E8%AA%9E%E8%A8%80">C</a>、<a href="https://zh.wikipedia.org/wiki/C%2B%2B">C++</a>、<a href="https://zh.wikipedia.org/wiki/C%E2%99%AF">C#</a>、<a href="https://zh.wikipedia.org/wiki/Go%E8%AF%AD%E8%A8%80">Go语言</a>、<a href="https://zh.wikipedia.org/wiki/Rust">Rust</a>等编程语言开发，大部分主要实现（<a href="https://zh.wikipedia.org/wiki/IOS">iOS</a>平台的除外）采用<a href="https://zh.wikipedia.org/wiki/Apache%E8%AE%B8%E5%8F%AF%E8%AF%81">Apache许可证</a>、<a href="https://zh.wikipedia.org/wiki/GPL">GPL</a>、<a href="https://zh.wikipedia.org/wiki/MIT%E8%A8%B1%E5%8F%AF%E8%AD%89">MIT许可证</a>等多种<a href="https://zh.wikipedia.org/wiki/%E8%87%AA%E7%94%B1%E8%BB%9F%E9%AB%94">自由软件</a>许可协议<a href="https://zh.wikipedia.org/wiki/%E9%96%8B%E6%94%BE%E5%8E%9F%E5%A7%8B%E7%A2%BC">开放源代码</a>。Shadowsocks分为服务器端和客户端，在使用之前，需要先将服务器端程序部署到服务器上面，然后通过客户端连接并创建本地代理。</p></blockquote><p>协议及软件持续更新(相对ssr)，占用内存较低(相对vmess)，可以使用低配置的Linux虚拟机(512MB内存/1核)</p><p>在一下会<strong>共享IP检测</strong>，<strong>DHCP检测VPN</strong>的网络下，使用搭载Shadowsocks的Linux虚拟机(虚拟机配置为桥接网络)，会有绝佳的效果</p><p>其他说明: 游戏用户须开启udp</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;wireguard&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#wireguard&quot;&gt;#&lt;/a&gt; &lt;a href=&quot;https://www.wireguard.com/&quot;&gt;WireGuard&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong</summary>
      
    
    
    
    
    <category term="network" scheme="https://you9you.github.io/tags/network/"/>
    
    <category term="tunnel" scheme="https://you9you.github.io/tags/tunnel/"/>
    
    <category term="wireguard" scheme="https://you9you.github.io/tags/wireguard/"/>
    
    <category term="openvpn" scheme="https://you9you.github.io/tags/openvpn/"/>
    
  </entry>
  
  <entry>
    <title>网络故障排错思路</title>
    <link href="https://you9you.github.io/20220121/network-check/"/>
    <id>https://you9you.github.io/20220121/network-check/</id>
    <published>2022-01-21T07:41:24.000Z</published>
    <updated>2023-05-20T02:26:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="主体思路"><a class="anchor" href="#主体思路">#</a> 主体思路</h2><ul><li><p>检查物理链路</p></li><li><p>查看本机IP地址、路由、DNS的设置；</p></li><li><p>测试网关或路由器的通畅情况。先测网关然后再测路由器，一级一级地测试；</p></li><li><p>测试ping公网IP的通畅情况</p></li><li><p>测试DNS的通畅情况</p></li></ul><h2 id="windows控制面板"><a class="anchor" href="#windows控制面板">#</a> Windows控制面板</h2><blockquote><p>控制面板 - 网络和 Internet - 网络连接</p></blockquote><p>可能的情况:</p><h3 id="一片空白"><a class="anchor" href="#一片空白">#</a> <s>一片空白</s></h3><blockquote><p>没有网卡/没装驱动</p></blockquote><h3 id="网络电缆被拔出"><a class="anchor" href="#网络电缆被拔出">#</a> 网络电缆被拔出</h3><blockquote><p>检查物理链路</p></blockquote><h3 id="未识别的网络"><a class="anchor" href="#未识别的网络">#</a> 未识别的网络</h3><blockquote><p>没有IP地址/网关配置错误</p><p>检查DHCP服务器设置</p></blockquote><h3 id="网络"><a class="anchor" href="#网络">#</a> 网络 *</h3><blockquote><p>正常网络(不包括DNS)</p></blockquote><h2 id="非底层错误方案"><a class="anchor" href="#非底层错误方案">#</a> 非底层错误方案</h2><h3 id="检查本地环回"><a class="anchor" href="#检查本地环回">#</a> 检查本地环回</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ping</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 127.0.0.1</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 正在 Ping 127.0.0.1 具有 32 字节的数据:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 来自 127.0.0.1 的回复: 字节=32 时间&#x3C;1ms TTL=128</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 来自 127.0.0.1 的回复: 字节=32 时间&#x3C;1ms TTL=128</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 来自 127.0.0.1 的回复: 字节=32 时间&#x3C;1ms TTL=128</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 来自 127.0.0.1 的回复: 字节=32 时间&#x3C;1ms TTL=128</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 127.0.0.1 的 Ping 统计信息:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#     数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 往返行程的估计时间(以毫秒为单位):</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#     最短 = 0ms，最长 = 0ms，平均 = 0ms</span></span></code></pre><blockquote><p>如果超时或者其他问题, 建议使用'官方镜像'重装系统</p></blockquote><h2 id="查看ip配置"><a class="anchor" href="#查看ip配置">#</a> 查看IP配置</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ipconfig</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /all</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 以太网适配器 以太网:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># </span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    连接特定的 DNS 后缀 . . . . . . . : lan</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    描述. . . . . . . . . . . . . . . : Realtek PCIe GbE Family Controller</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    物理地址. . . . . . . . . . . . . : ***</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    DHCP 已启用 . . . . . . . . . . . : 是</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    IPv4 地址 . . . . . . . . . . . . : 192.168.1.**(首选)</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    子网掩码  . . . . . . . . . . . . : 255.255.255.0</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    获得租约的时间  . . . . . . . . . : 2022年1月21日 15:44:36</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    租约过期的时间  . . . . . . . . . : 2022年1月22日 15:44:35</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    默认网关. . . . . . . . . . . . . : 192.168.1.1</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    DHCP 服务器 . . . . . . . . . . . : 192.168.1.1</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    DNS 服务器  . . . . . . . . . . . : 192.168.1.10</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">#    TCPIP 上的 NetBIOS  . . . . . . . : 已启用</span></span><span class="line"></span><span class="line"></span></code></pre><blockquote><p>如果IPv4地址为169.254.*.*</p><p>检查DHCP服务器设置</p></blockquote><h3 id="尝试使用ping测试网关-dns服务器的连通性"><a class="anchor" href="#尝试使用ping测试网关-dns服务器的连通性">#</a> 尝试使用ping测试网关、DNS服务器的连通性</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ping</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">gatewa</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">y</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ping 192.168.1.1</span></span><span class="line"></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ping</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">dn</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">s</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ping 192.168.1.10</span></span></code></pre><h3 id="尝试使用ping测试公共服务器的连通性"><a class="anchor" href="#尝试使用ping测试公共服务器的连通性">#</a> 尝试使用ping测试公共服务器的连通性</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ping</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 223.5.5.5</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ali DNS</span></span><span class="line"></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ping</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 114.114.114.114</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 114 DNS</span></span></code></pre><h3 id="尝试使用nslookup测试域名解析"><a class="anchor" href="#尝试使用nslookup测试域名解析">#</a> 尝试使用nslookup测试域名解析</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">nslookup</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">domain.co</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">m</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># nslookup baidu.com</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 使用系统设置的DNS进行解析</span></span><span class="line"></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">nslookup</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">domain.co</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">m</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">DNS</span><span style="color:#B56959;--shiki-dark:#C98A7D"> Serve</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">r</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># nslookup baidu.com 223.5.5.5</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 指定DNS服务器进行解析</span></span></code></pre><h3 id="尝试使用ping测试域名解析"><a class="anchor" href="#尝试使用ping测试域名解析">#</a> 尝试使用ping测试域名解析</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ping</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">domain.co</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">m</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ping baidu.com</span></span></code></pre><blockquote><p>如果使用'nslookup'测试正常, 但ping无法连通, 检查'hosts'文件</p></blockquote><h3 id="尝试使用curl测试http"><a class="anchor" href="#尝试使用curl测试http">#</a> 尝试使用curl测试HTTP</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">curl</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -v</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x3C;</span><span style="color:#B56959;--shiki-dark:#C98A7D">http_20</span><span style="color:#AB5959;--shiki-dark:#CB7676">4</span><span style="color:#AB5959;--shiki-dark:#CB7676">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># curl -v http://connectivitycheck.gstatic.com/generate_204</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># [gstatic.com] http://connectivitycheck.gstatic.com/generate_204</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># [google.cn] http://www.google.cn/generate_204</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># [miui.com] http://connect.rom.miui.com/generate_204</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># [hicloud.com] http://connectivitycheck.platform.hicloud.com/generate_204</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># *   Trying ***:80...</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># * Connected to connectivitycheck.gstatic.com (***) port 80 (#0)</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># > GET /generate_204 HTTP/1.1</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># > Host: connectivitycheck.gstatic.com</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># > User-Agent: curl/7.79.1</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># > Accept: */*</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># * Mark bundle as not supporting multiuse</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># &#x3C; HTTP/1.1 204 No Content</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># &#x3C; Content-Length: 0</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># &#x3C; Date: Fri, 21 Jan 2022 08:09:26 GMT</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># &#x3C;</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># * Connection #0 to host connectivitycheck.gstatic.com left intact</span></span></code></pre><blockquote><p>关键字: 204 No Content</p></blockquote><h2 id="windows-互联网检测基准"><a class="anchor" href="#windows-互联网检测基准">#</a> Windows 互联网检测基准</h2><p><a href="http://www.msftconnecttest.com/connecttest.txt">http://www.msftconnecttest.com/connecttest.txt</a></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>Microsoft Connect Test</span></span></code></pre><p><a href="http://www.msftncsi.com/ncsi.txt">http://www.msftncsi.com/ncsi.txt</a></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>Microsoft NCSI</span></span></code></pre><p>dns://dns.msftncsi.com</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>fd3e:4f5a:5b81::1</span></span><span class="line"><span>131.107.255.255</span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;主体思路&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#主体思路&quot;&gt;#&lt;/a&gt; 主体思路&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;检查物理链路&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查看本机IP地址、路由、DNS的设置；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;测试网</summary>
      
    
    
    
    
    <category term="curl" scheme="https://you9you.github.io/tags/curl/"/>
    
    <category term="network" scheme="https://you9you.github.io/tags/network/"/>
    
    <category term="ping" scheme="https://you9you.github.io/tags/ping/"/>
    
    <category term="nslookup" scheme="https://you9you.github.io/tags/nslookup/"/>
    
  </entry>
  
  <entry>
    <title>teamspeak</title>
    <link href="https://you9you.github.io/20220120/teamspeak/"/>
    <id>https://you9you.github.io/20220120/teamspeak/</id>
    <published>2022-01-20T09:03:31.000Z</published>
    <updated>2022-01-20T09:54:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装包"><a class="anchor" href="#安装包">#</a> 安装包</h2><ul><li>官方[<a href="https://www.teamspeak.com/zh-CN/downloads/">https://www.teamspeak.com/zh-CN/downloads/</a>]</li><li>虎符电竞[<a href="https://ts.zhaoq.me/">https://ts.zhaoq.me/</a>]</li><li><s>国内定制[<a href="http://www.ts1.cn/download">http://www.ts1.cn/download</a>]</s></li></ul><h2 id="插件"><a class="anchor" href="#插件">#</a> 插件</h2><ul><li>简体中文[<a href="https://github.com/jitingcn/TS3-Translation_zh-CN/releases">https://github.com/jitingcn/TS3-Translation_zh-CN/releases</a>]</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;安装包&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#安装包&quot;&gt;#&lt;/a&gt; 安装包&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;官方[&lt;a href=&quot;https://www.teamspeak.com/zh-CN/downloads/&quot;&gt;https://www.teams</summary>
      
    
    
    
    
    <category term="teamspeak" scheme="https://you9you.github.io/tags/teamspeak/"/>
    
  </entry>
  
</feed>
