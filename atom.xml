<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>you9you的笔记本</title>
  
  <subtitle>一些简单的记录</subtitle>
  <link href="https://you9you.github.io/atom.xml" rel="self"/>
  
  <link href="https://you9you.github.io/"/>
  <updated>2025-04-26T13:21:51.299Z</updated>
  <id>https://you9you.github.io/</id>
  
  <author>
    <name>you9you</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Kohya_ss因图片错误导致训练报错</title>
    <link href="https://you9you.github.io/20250416/kohya_ss_exception/"/>
    <id>https://you9you.github.io/20250416/kohya_ss_exception/</id>
    <published>2025-04-16T14:51:00.000Z</published>
    <updated>2025-04-26T13:21:51.299Z</updated>
    
    <content type="html"><![CDATA[<h2 id="可能出现的错误"><a class="markdownIt-Anchor" href="#可能出现的错误">#</a> 可能出现的错误</h2><blockquote><p>OSError: image file is truncated (7 bytes not processed)</p></blockquote><blockquote><p>OSError: broken data stream when reading image file</p></blockquote><blockquote><p>OSError: image file is truncated (1 bytes not processed)</p></blockquote><h2 id="解决方案-预检测脚本"><a class="markdownIt-Anchor" href="#解决方案-预检测脚本">#</a> 解决方案 - 预检测脚本</h2><h3 id="预检测脚本deepseek-生成"><a class="markdownIt-Anchor" href="#预检测脚本deepseek-生成">#</a> 预检测脚本（DeepSeek 生成）</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm  <span class="token comment"># 用于显示进度条，可选</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">check_image</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">with</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span> <span class="token keyword">as</span> img<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token comment"># 强制加载所有像素数据</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            img<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token comment"># 进一步验证图像完整性（可选）</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            img<span class="token punctuation">.</span>tobytes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">"truncated"</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"损坏文件: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>file_path<span class="token punctuation">&#125;</span></span><span class="token string"> - 错误信息: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">False</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token comment"># 其他类型的 OSError 也需要处理</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效文件: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>file_path<span class="token punctuation">&#125;</span></span><span class="token string"> - 错误信息: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">False</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"未知错误: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>file_path<span class="token punctuation">&#125;</span></span><span class="token string"> - 错误类型: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">type</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__<span class="token punctuation">&#125;</span></span><span class="token string">, 信息: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">False</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">def</span> <span class="token function">scan_images_directory</span><span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    corrupted_files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    </pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment"># 支持常见图片格式</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    image_extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'.jpg'</span><span class="token punctuation">,</span> <span class="token string">'.jpeg'</span><span class="token punctuation">,</span> <span class="token string">'.png'</span><span class="token punctuation">,</span> <span class="token string">'.webp'</span><span class="token punctuation">,</span> <span class="token string">'.bmp'</span><span class="token punctuation">,</span> <span class="token string">'.tiff'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    </pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment"># 遍历目录</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">for</span> root<span class="token punctuation">,</span> _<span class="token punctuation">,</span> files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>files<span class="token punctuation">,</span> desc<span class="token operator">=</span><span class="token string">"正在扫描文件"</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span>ext<span class="token punctuation">)</span> <span class="token keyword">for</span> ext <span class="token keyword">in</span> image_extensions<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token keyword">if</span> <span class="token keyword">not</span> check_image<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    corrupted_files<span class="token punctuation">.</span>append<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    </pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment"># 输出总结报告</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n扫描完成！"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">if</span> corrupted_files<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"发现 </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>corrupted_files<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> 个损坏文件:"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">for</span> path <span class="token keyword">in</span> corrupted_files<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f" - </span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"未发现损坏文件"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">import</span> argparse</pre></td></tr><tr><td data-num="50"></td><td><pre>    </pre></td></tr><tr><td data-num="51"></td><td><pre>    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"检测损坏的图片文件"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"directory"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"要扫描的目录路径"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    </pre></td></tr><tr><td data-num="55"></td><td><pre>    scan_images_directory<span class="token punctuation">(</span>args<span class="token punctuation">.</span>directory<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="安装依赖"><a class="markdownIt-Anchor" href="#安装依赖">#</a> 安装依赖</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>pip <span class="token function">install</span> Pillow tqdm</pre></td></tr></table></figure><h3 id="运行脚本"><a class="markdownIt-Anchor" href="#运行脚本">#</a> 运行脚本</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>python check_images.py <span class="token operator">&lt;</span>你的图片目录路径<span class="token operator">></span></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;可能出现的错误&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#可能出现的错误&quot;&gt;#&lt;/a&gt; 可能出现的错误&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;OSError: image file is truncated (7 bytes n</summary>
      
    
    
    
    
    <category term="python" scheme="https://you9you.github.io/tags/python/"/>
    
    <category term="Kohya_ss" scheme="https://you9you.github.io/tags/Kohya-ss/"/>
    
    <category term="Stable Diffusion" scheme="https://you9you.github.io/tags/Stable-Diffusion/"/>
    
    <category term="AI" scheme="https://you9you.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>更新至Python 3.13导致的自签名CA出现[SSL CERTIFICATE_VERIFY_FAILED] certificate verify failed Missing Authority Key Identifier</title>
    <link href="https://you9you.github.io/20250106/python3.13_x509_strict/"/>
    <id>https://you9you.github.io/20250106/python3.13_x509_strict/</id>
    <published>2025-01-06T07:12:00.000Z</published>
    <updated>2025-01-06T07:28:34.745Z</updated>
    
    <content type="html"><![CDATA[<h1 id="更新至python-313导致的自签名ca出现ssl-certificate_verify_failed-certificate-verify-failed-missing-authority-key-identifier"><a class="markdownIt-Anchor" href="#更新至python-313导致的自签名ca出现ssl-certificate_verify_failed-certificate-verify-failed-missing-authority-key-identifier">#</a> 更新至 Python 3.13 导致的自签名 CA 出现 [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: Missing Authority Key Identifier</h1><h2 id="排查"><a class="markdownIt-Anchor" href="#排查">#</a> 排查</h2><ul><li>查看<a href="https://docs.python.org/3/whatsnew/3.13.html#ssl"> python 更新日志</a></li><li>测试 <code>x509_strict</code></li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>openssl verify <span class="token parameter variable">-x509_strict</span> <span class="token parameter variable">-CAfile</span> /data/ca.crt /data/web/web1.crt</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># error 92 at 1 depth lookup: CA cert does not include key usage extension</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># error /data/web/web1.crt: verification failed</span></pre></td></tr></table></figure><h2 id="重新生成ca证书"><a class="markdownIt-Anchor" href="#重新生成ca证书">#</a> 重新生成 CA 证书</h2><blockquote><p>重新根据 ca.key 生成 ca.crt，只需替换 ca.crt 即可，已经颁发的证书仍正常使用。</p></blockquote><h3 id="复制一份-opensslcnf可选"><a class="markdownIt-Anchor" href="#复制一份-opensslcnf可选">#</a> 复制一份 openssl.cnf（可选）</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">cp</span> /etc/ssl/openssl.cnf openssl_ca.cnf</pre></td></tr></table></figure><h3 id="调整-opensslcnf"><a class="markdownIt-Anchor" href="#调整-opensslcnf">#</a> 调整 openssl.cnf</h3><p>编辑 <code>openssl_ca.cnf</code>  并将其中 <code>[ v3_ca ]</code>  下的 <code>keyUsage = cRLSign, keyCertSign</code>  解除注释</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span> v3_ca <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># Key usage: this is typical for a CA certificate. However since it will</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># prevent it being used as an test self-signed certificate it is best</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># left out by default.</span></pre></td></tr><tr><td data-num="6"></td><td><pre>keyUsage <span class="token operator">=</span> cRLSign, keyCertSign</pre></td></tr></table></figure><h3 id="生成证书请求文件csr已有csr可忽略"><a class="markdownIt-Anchor" href="#生成证书请求文件csr已有csr可忽略">#</a> 生成证书请求文件 csr（已有 csr 可忽略）</h3><p>生成证书请求文件 csr，需要使用原 <code>ca.crt</code>  和 <code>ca.key</code></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>openssl x509 <span class="token parameter variable">-x509toreq</span> <span class="token parameter variable">-in</span> ca.crt <span class="token parameter variable">-signkey</span> ca.key <span class="token parameter variable">-out</span> new-ca.csr</pre></td></tr></table></figure><h3 id="生成ca证书"><a class="markdownIt-Anchor" href="#生成ca证书">#</a> 生成 ca 证书</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-days</span> <span class="token number">3650</span> <span class="token parameter variable">-extfile</span> openssl_ca.cnf <span class="token parameter variable">-extensions</span> v3_ca <span class="token parameter variable">-in</span> new-ca.csr <span class="token parameter variable">-signkey</span> ca.key <span class="token parameter variable">-out</span> new-ca.crt</pre></td></tr></table></figure><h2 id="测试"><a class="markdownIt-Anchor" href="#测试">#</a> 测试</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>openssl verify <span class="token parameter variable">-x509_strict</span> <span class="token parameter variable">-CAfile</span> new-ca.crt /data/web/web1.crt</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># /data/web/web1.crt: OK</span></pre></td></tr></table></figure><h2 id="导入到系统可信ca可选"><a class="markdownIt-Anchor" href="#导入到系统可信ca可选">#</a> 导入到系统可信 CA（可选）</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">cp</span> new-ca.crt /usr/local/share/ca-certificates/</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> update-ca-certificates</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># Updating certificates in /etc/ssl/certs...</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 0 added, 0 removed; done.</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># Running hooks in /etc/ca-certificates/update.d...</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># Processing triggers for ca-certificates-java (20240118) ...</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># done.</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># done.</span></pre></td></tr></table></figure><h2 id="参考"><a class="markdownIt-Anchor" href="#参考">#</a> 参考</h2><p><a href="https://www.cnblogs.com/liweifeng888/p/18648432">https://www.cnblogs.com/liweifeng888/p/18648432</a><br><a href="https://superuser.com/questions/738612/openssl-ca-keyusage-extension">https://superuser.com/questions/738612/openssl-ca-keyusage-extension</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;更新至python-313导致的自签名ca出现ssl-certificate_verify_failed-certificate-verify-failed-missing-authority-key-identifier&quot;&gt;&lt;a class=&quot;markdownI</summary>
      
    
    
    
    
    <category term="python" scheme="https://you9you.github.io/tags/python/"/>
    
    <category term="openssl" scheme="https://you9you.github.io/tags/openssl/"/>
    
    <category term="certificate" scheme="https://you9you.github.io/tags/certificate/"/>
    
    <category term="self-signed certificates" scheme="https://you9you.github.io/tags/self-signed-certificates/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统的人脸识别身份验证</title>
    <link href="https://you9you.github.io/20240515/howdy-face-unlock-linux/"/>
    <id>https://you9you.github.io/20240515/howdy-face-unlock-linux/</id>
    <published>2024-05-15T05:53:00.000Z</published>
    <updated>2024-05-15T06:27:47.860Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2><p><a href="https://github.com/boltgolt/howdy">Howdy</a> 为 Linux 提供 Windows Hello 风格的身份验证。<br>使用内置红外发射器和摄像头与面部识别相结合来证明您是谁。</p><p>使用中央身份验证系统 (PAM)，这可以在您需要密码的任何地方使用：登录、锁定屏幕、sudo、su 等。</p><h2 id="安装前提"><a class="markdownIt-Anchor" href="#安装前提">#</a> 安装前提</h2><p>确保 <code>pypi</code>  和 <code>github</code>  访问正常</p><h2 id="安装ubuntu"><a class="markdownIt-Anchor" href="#安装ubuntu">#</a> 安装 (Ubuntu)</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> add-apt-repository ppa:boltgolt/howdy</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> update</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> howdy</pre></td></tr></table></figure><blockquote><p>在安装过程中会有如下 3 个选项可供选择：<br>F：Fast 快速<br> B：Balanced 平衡<br> S：Securs 安全</p></blockquote><h2 id="查看所有摄像头设备"><a class="markdownIt-Anchor" href="#查看所有摄像头设备">#</a> 查看所有摄像头设备</h2><blockquote><p>在大多数 Linux 系统中， <code>/dev/video*</code>  为摄像头设备。</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ls</span> /dev/video*</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># /dev/video0  /dev/video1  /dev/video2  /dev/video3</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># thinkbook 中 video0 为红外相机</span></pre></td></tr></table></figure><h2 id="配置howdy"><a class="markdownIt-Anchor" href="#配置howdy">#</a> 配置 Howdy</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> howdy config</pre></td></tr></table></figure><p>查找以 <code>device_path</code>  开头的行，将其改为 <code>/dev/video0</code>  或你摄像头的实际路径。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>video<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># The path of the device to capture frames from</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># Should be set automatically by an installer if your distro has one</span></pre></td></tr><tr><td data-num="6"></td><td><pre>device_path <span class="token operator">=</span> /dev/video0</pre></td></tr></table></figure><h2 id="添加面部模型记录"><a class="markdownIt-Anchor" href="#添加面部模型记录">#</a> 添加面部模型记录</h2><p>通过以下命令将人脸与特定 username 用户相关联：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> howdy <span class="token parameter variable">-U</span> username <span class="token function">add</span></pre></td></tr></table></figure><p>配置好后 Howdy 就会随系统启动而自动启动，你可以在下次登录时就自动通过人脸设别登录。<br>在其它要验证权限的时候，Howdy 也可以直接免密授权，例如执行 sudo 提权时。</p><h2 id="其他"><a class="markdownIt-Anchor" href="#其他">#</a> 其他</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 添加面部模型记录</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> howdy <span class="token function">add</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> howdy <span class="token parameter variable">-U</span> username <span class="token function">add</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 编辑配置</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">sudo</span> howdy config</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 查看面部模型记录</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">sudo</span> howdy list</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 删除指定 ID 的面部记录</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">sudo</span> howdy remove <span class="token operator">&lt;</span>face_ID<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 清除所有面部模型记录</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">sudo</span> howdy <span class="token function">clear</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 禁用 Howdy 功能</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token function">sudo</span> howdy disable <span class="token number">1</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 启用 Howdy 功能</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function">sudo</span> howdy disable <span class="token number">0</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># 保存快照</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token function">sudo</span> howdy snapshot</pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># 测试摄像头是否能找到面部 (Ctrl+C 取消)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token function">sudo</span> howdy <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment"># 查看版本</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token function">sudo</span> howdy version</pre></td></tr></table></figure><h2 id="错误"><a class="markdownIt-Anchor" href="#错误">#</a> 错误</h2><h3 id="在添加面部模型时"><a class="markdownIt-Anchor" href="#在添加面部模型时">#</a> 在添加面部模型时</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="2"></td><td><pre>  File <span class="token string">"/usr/local/bin/howdy"</span>, line <span class="token number">95</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">import</span> cli.add</pre></td></tr><tr><td data-num="4"></td><td><pre>  File <span class="token string">"/usr/lib/security/howdy/cli/add.py"</span>, line <span class="token number">48</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    face_encoder <span class="token operator">=</span> dlib.face_recognition_model_v1<span class="token punctuation">(</span>path + <span class="token string">"/../dlib-data/dlib_face_recognition_resnet_model_v1.dat"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>RuntimeError: Unable to <span class="token function">open</span> /usr/lib/security/howdy/cli/<span class="token punctuation">..</span>/dlib-data/dlib_face_recognition_resnet_model_v1.dat <span class="token keyword">for</span> reading.</pre></td></tr></table></figure><blockquote><p>原因：因网络或其他问题导致的模型数据缺失</p></blockquote><blockquote><p>解决方法：重新安装模型数据</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> /usr/lib/security/howdy/dlib-data</pre></td></tr><tr><td data-num="2"></td><td><pre>./install.sh</pre></td></tr></table></figure><h2 id="参考"><a class="markdownIt-Anchor" href="#参考">#</a> 参考</h2><p><a href="https://www.sysgeek.cn/howdy-face-unlock-linux/">Howdy— 适用于 Linux 系统的人脸识别身份验证，安装和配置指南</a><br><a href="https://github.com/boltgolt/howdy/issues/666"> RuntimeError: Unable to open /usr/lib/security/howdy/cli/…/dlib-data/dlib_face_recognition_resnet_model_v1.dat for reading.</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;简介&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#简介&quot;&gt;#&lt;/a&gt; 简介&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/boltgolt/howdy&quot;&gt;Howdy&lt;/a&gt; 为 Linux 提供 Window</summary>
      
    
    
    
    
    <category term="howdy" scheme="https://you9you.github.io/tags/howdy/"/>
    
    <category term="linux" scheme="https://you9you.github.io/tags/linux/"/>
    
    <category term="python" scheme="https://you9you.github.io/tags/python/"/>
    
    <category term="opencv" scheme="https://you9you.github.io/tags/opencv/"/>
    
  </entry>
  
  <entry>
    <title>LibreOffice Merge</title>
    <link href="https://you9you.github.io/20240410/libreoffice-merge/"/>
    <id>https://you9you.github.io/20240410/libreoffice-merge/</id>
    <published>2024-04-10T02:13:41.000Z</published>
    <updated>2024-04-10T02:18:07.399Z</updated>
    
    <content type="html"><![CDATA[<h1 id="libreoffice-文档-合并"><a class="markdownIt-Anchor" href="#libreoffice-文档-合并">#</a> LibreOffice 文档 合并</h1><h2 id="docx-pdf"><a class="markdownIt-Anchor" href="#docx-pdf">#</a> *.docx -&gt; pdf</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># *.docx -> *.pdf</span></pre></td></tr><tr><td data-num="2"></td><td><pre>libreoffice <span class="token parameter variable">--headless</span> --convert-to pdf *.docx</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># *.pdf -> final.pdf</span></pre></td></tr><tr><td data-num="5"></td><td><pre>pdfunite *.pdf final.pdf</pre></td></tr></table></figure><h2 id="jpg-pdf"><a class="markdownIt-Anchor" href="#jpg-pdf">#</a> *.jpg -&gt; pdf</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># *.jpg -> *.pdf</span></pre></td></tr><tr><td data-num="2"></td><td><pre>libreoffice <span class="token parameter variable">--headless</span> --convert-to pdf *.jpg</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># *.pdf -> final.pdf</span></pre></td></tr><tr><td data-num="5"></td><td><pre>pdfunite *.pdf final.pdf</pre></td></tr></table></figure><h2 id="参考"><a class="markdownIt-Anchor" href="#参考">#</a> 参考</h2><p><a href="https://www.cnblogs.com/greenhui/p/13137749.html">使用 libreoffice 批量化转化文件为 .pdf 并合并</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;libreoffice-文档-合并&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#libreoffice-文档-合并&quot;&gt;#&lt;/a&gt; LibreOffice 文档 合并&lt;/h1&gt;
&lt;h2 id=&quot;docx-pdf&quot;&gt;&lt;a class=&quot;m</summary>
      
    
    
    
    
    <category term="libreoffice" scheme="https://you9you.github.io/tags/libreoffice/"/>
    
    <category term="docx" scheme="https://you9you.github.io/tags/docx/"/>
    
  </entry>
  
  <entry>
    <title>更新Linux内核至 6.5 后无法启动 VirtualBox</title>
    <link href="https://you9you.github.io/20240116/linux6-5-vbox/"/>
    <id>https://you9you.github.io/20240116/linux6-5-vbox/</id>
    <published>2024-01-16T01:27:19.000Z</published>
    <updated>2024-01-18T01:30:28.603Z</updated>
    
    <content type="html"><![CDATA[<h1 id="更新linux内核至-65-后无法启动-virtualbox"><a class="markdownIt-Anchor" href="#更新linux内核至-65-后无法启动-virtualbox">#</a> 更新 Linux 内核至 6.5 后无法启动 VirtualBox</h1><blockquote><p>kernel driver not installed</p></blockquote><h2 id="系统"><a class="markdownIt-Anchor" href="#系统">#</a> 系统</h2><p>Ubuntu 22.04.3 LTS</p><h2 id="排查"><a class="markdownIt-Anchor" href="#排查">#</a> 排查</h2><p>错误在更新至内核 ( <code>6.5.0-14-generic</code> ) 后出现的，尝试切换内核</p><p>切换至 <code>6.2.0-39-generic</code>  时正常</p><p>在 <code>6.5.0-14-generic</code>  中执行 <code>modprobe vboxdrv</code> ，发现 <code>FATAL: Module vboxdrv not found. </code></p><p>在 <code>6.2.0-39-generic</code>  中执行 <code>modinfo vboxdrv</code> ，查看路径 <code>filename:       /lib/modules/6.2.0-39-generic/misc/vboxdrv.ko</code></p><p>发现 <code>/lib/modules/6.5.0-14-generic/misc/</code>  不存在</p><p>查看 vbox 安装日志 <code>cat /var/log/vbox-setup.log</code> ，发现 <code>/bin/sh: 1: gcc-12: not found</code></p><h2 id="尝试修复"><a class="markdownIt-Anchor" href="#尝试修复">#</a> 尝试修复</h2><p>切换至 <code>6.5.0-14-generic</code></p><p>安装 gcc-12 <code>sudo apt install gcc-12</code></p><p>重新安装 vbox <code>sudo apt install --reinstall ./virtualbox-7.0_7.0.12-159484~Ubuntu~jammy_amd64.deb</code></p><p>查看模块</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">ls</span> /lib/modules/6.5.0-14-generic/misc/</pre></td></tr><tr><td data-num="2"></td><td><pre>vboxdrv.ko  vboxnetadp.ko  vboxnetflt.ko</pre></td></tr></table></figure><p>VirtualBox 已恢复正常</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;更新linux内核至-65-后无法启动-virtualbox&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#更新linux内核至-65-后无法启动-virtualbox&quot;&gt;#&lt;/a&gt; 更新 Linux 内核至 6.5 后无法启动 Vir</summary>
      
    
    
    
    
    <category term="linux" scheme="https://you9you.github.io/tags/linux/"/>
    
    <category term="virtualbox" scheme="https://you9you.github.io/tags/virtualbox/"/>
    
    <category term="ubuntu" scheme="https://you9you.github.io/tags/ubuntu/"/>
    
    <category term="vboxdrv" scheme="https://you9you.github.io/tags/vboxdrv/"/>
    
  </entry>
  
  <entry>
    <title>Duck DNS &amp; Let&#39;s Encrypt</title>
    <link href="https://you9you.github.io/20230520/Duck-DNS-Let-s-Encrypt/"/>
    <id>https://you9you.github.io/20230520/Duck-DNS-Let-s-Encrypt/</id>
    <published>2023-05-20T02:11:05.000Z</published>
    <updated>2023-07-20T03:03:44.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用duck-dns获取lets-encrypt证书"><a class="markdownIt-Anchor" href="#使用duck-dns获取lets-encrypt证书">#</a> 使用 Duck DNS 获取 Let’s Encrypt 证书</h1><h2 id="注册duck-dns"><a class="markdownIt-Anchor" href="#注册duck-dns">#</a> 注册 Duck DNS</h2><p><a href="https://www.duckdns.org/">https://www.duckdns.org/</a><br> 略</p><h2 id="安装certbot"><a class="markdownIt-Anchor" href="#安装certbot">#</a> 安装 certbot</h2><h3 id="nginx服务器ubuntu"><a class="markdownIt-Anchor" href="#nginx服务器ubuntu">#</a> nginx 服务器 (Ubuntu)</h3><h4 id="安装certbot-2"><a class="markdownIt-Anchor" href="#安装certbot-2">#</a> 安装 certbot</h4><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> certbot</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3-certbot-nginx</pre></td></tr></table></figure><h4 id="创建申请"><a class="markdownIt-Anchor" href="#创建申请">#</a> 创建申请</h4><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> certbot <span class="token parameter variable">--manual</span> --preferred-challenges dns certonly</pre></td></tr></table></figure><p>后会有类似以下提示：</p><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</pre></td></tr><tr><td data-num="2"></td><td><pre>Please deploy a DNS TXT record under the name:</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>_acme-challenge.test.duckdns.org.</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>with the following value:</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>sz8QCaKoQBBO5pYqTIUIVr-twoQYaa5yYiWHfcuDDTo</pre></td></tr><tr><td data-num="9"></td><td><pre>    </pre></td></tr><tr><td data-num="10"></td><td><pre>Before continuing, verify the record is deployed.</pre></td></tr><tr><td data-num="11"></td><td><pre>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</pre></td></tr><tr><td data-num="12"></td><td><pre>Press Enter to Continue</pre></td></tr></table></figure><h4 id="更改txt记录"><a class="markdownIt-Anchor" href="#更改txt记录">#</a> 更改 TXT 记录</h4><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># curl https://www.duckdns.org/update?domains=&#123;YOURVALUE&#125;&amp;token=&#123;YOURVALUE&#125;&amp;txt=&#123;YOURVALUE&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 也可以浏览器访问，回显 "OK"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">curl</span> https://www.duckdns.org/update?domains<span class="token operator">=</span>test.duckdns.org<span class="token operator">&amp;</span><span class="token assign-left variable">token</span><span class="token operator">=</span>00000000-0000-0000-0000-00000000000f<span class="token operator">&amp;</span><span class="token assign-left variable">txt</span><span class="token operator">=</span>sz8QCaKoQBBO5pYqTIUIVr-twoQYaa5yYiWHfcuDDTo</pre></td></tr></table></figure><h4 id="继续申请"><a class="markdownIt-Anchor" href="#继续申请">#</a> 继续申请</h4><p>按 <code>Enter</code></p><h4 id="成功提示"><a class="markdownIt-Anchor" href="#成功提示">#</a> 成功提示</h4><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>Successfully received certificate.</pre></td></tr><tr><td data-num="2"></td><td><pre>Certificate is saved at: /etc/letsencrypt/live/test.duckdns.org/fullchain.pem</pre></td></tr><tr><td data-num="3"></td><td><pre>Key is saved at:         /etc/letsencrypt/live/test.duckdns.org/privkey.pem</pre></td></tr><tr><td data-num="4"></td><td><pre>This certificate expires on 2023-08-18.</pre></td></tr><tr><td data-num="5"></td><td><pre>These files will be updated when the certificate renews.</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>NEXT STEPS:</pre></td></tr><tr><td data-num="8"></td><td><pre>- This certificate will not be renewed automatically. Autorenewal of --manual certificates requires the use of an authentication hook script (--manual-auth-hook) but one was not provided. To renew this certificate, repeat this same certbot command before the certificate's expiry date.</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</pre></td></tr><tr><td data-num="11"></td><td><pre>If you like Certbot, please consider supporting our work by:</pre></td></tr><tr><td data-num="12"></td><td><pre> * Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate</pre></td></tr><tr><td data-num="13"></td><td><pre> * Donating to EFF:                    https://eff.org/donate-le</pre></td></tr><tr><td data-num="14"></td><td><pre>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</pre></td></tr></table></figure><p>证书： <code>/etc/letsencrypt/live/test.duckdns.org/fullchain.pem</code> <br> 私钥： <code>/etc/letsencrypt/live/test.duckdns.org/privkey.pem</code></p><h4 id="创建自动续签任务"><a class="markdownIt-Anchor" href="#创建自动续签任务">#</a> 创建自动续签任务</h4><p>保存 <code>certbot-auth-duckdns.sh</code></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># Create: certbot certonly --manual --preferred-challenges dns-01 --email mail@domain.com -d laravel.run -d *.laravel.run --server https://acme-v02.api.letsencrypt.org/directory --manual-auth-hook /path/to/certbot-auth-duckdns.sh</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># Renew:  certbot renew --manual-auth-hook /path/to/certbot-auth-duckdns.sh</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># https://github.com/al-one/certbot-auth-dnspod/</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token assign-left variable">API_TOKEN</span><span class="token operator">=</span><span class="token string">""</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$API_TOKEN</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token environment constant">$HOME</span>/.duckdns_token_<span class="token variable">$CERTBOT_DOMAIN</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">API_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> <span class="token environment constant">$HOME</span>/.duckdns_token_$CERTBOT_DOMAIN<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$API_TOKEN</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/duckdns_token_<span class="token variable">$CERTBOT_DOMAIN</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">API_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/duckdns_token_$CERTBOT_DOMAIN<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$API_TOKEN</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token environment constant">$HOME</span>/.duckdns_token <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">API_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> <span class="token environment constant">$HOME</span>/.duckdns_token<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$API_TOKEN</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/duckdns_token <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">API_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/duckdns_token<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$API_TOKEN</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token assign-left variable">API_TOKEN</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$DUCKDNS_TOKEN</span>"</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"\</pre></td></tr><tr><td data-num="34"></td><td><pre>DOMAIN: <span class="token variable">$CERTBOT_DOMAIN</span></pre></td></tr><tr><td data-num="35"></td><td><pre>VALIDATION:     <span class="token variable">$CERTBOT_VALIDATION</span>"</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment"># CERTBOT_DOMAIN: test.duckdns.org</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># VALIDATION:     ********</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment"># curl https://www.duckdns.org/update?domains=test.duckdns.org&amp;token=00000000-0000-0000-0000-00000000000f&amp;txt=sz8QCaKoQB</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">=</span> <span class="token string">"clean"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token assign-left variable">APIRET</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"https://www.duckdns.org/update?domains=<span class="token variable">$CERTBOT_DOMAIN</span>&amp;token=<span class="token variable">$API_TOKEN</span>&amp;txt="</span><span class="token variable">)</span></span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Remove Record: <span class="token variable">$CERTBOT_DOMAIN</span> - <span class="token variable">$APIRET</span>"</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">else</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token assign-left variable">APIRET</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"https://www.duckdns.org/update?domains=<span class="token variable">$CERTBOT_DOMAIN</span>&amp;token=<span class="token variable">$API_TOKEN</span>&amp;txt=<span class="token variable">$CERTBOT_VALIDATION</span>"</span><span class="token variable">)</span></span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Update Record: <span class="token variable">$CERTBOT_DOMAIN</span> - <span class="token variable">$APIRET</span>"</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token comment"># Sleep to make sure the change has time to propagate over to DNS</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token function">sleep</span> <span class="token number">30</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token keyword">fi</span></pre></td></tr></table></figure><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">crontab</span> <span class="token parameter variable">-e</span></pre></td></tr></table></figure><p>保持在线状态以免证书被吊销。在证书到期或续订之前不会执行任何操作。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">0</span> */12 * * * <span class="token builtin class-name">export</span> <span class="token assign-left variable">DUCKDNS_TOKEN</span><span class="token operator">=</span>00000000-0000-0000-0000-00000000000f <span class="token operator">&amp;&amp;</span> python3 <span class="token parameter variable">-c</span> <span class="token string">'import random; import time; time.sleep(random.random() * 3600)'</span> <span class="token operator">&amp;&amp;</span> certbot renew --manual-auth-hook /path/to/certbot-auth-duckdns.sh</pre></td></tr></table></figure><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</pre></td></tr><tr><td data-num="2"></td><td><pre>Processing /etc/letsencrypt/renewal/test.duckdns.org.conf</pre></td></tr><tr><td data-num="3"></td><td><pre>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</pre></td></tr><tr><td data-num="4"></td><td><pre>Renewing an existing certificate for test.duckdns.org</pre></td></tr><tr><td data-num="5"></td><td><pre>Hook '--manual-auth-hook' for test.duckdns.org ran with output:</pre></td></tr><tr><td data-num="6"></td><td><pre> CERTBOT_DOMAIN: test.duckdns.org</pre></td></tr><tr><td data-num="7"></td><td><pre> VALIDATION:     sz8QCaKoQBBO5pYqTIUIVr-twoQYaa5yYiWHfcuDDTo</pre></td></tr><tr><td data-num="8"></td><td><pre> Update Record:  test.duckdns.org - OK</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</pre></td></tr><tr><td data-num="11"></td><td><pre>Congratulations, all renewals succeeded: </pre></td></tr><tr><td data-num="12"></td><td><pre>  /etc/letsencrypt/live/test.duckdns.org/fullchain.pem (success)</pre></td></tr><tr><td data-num="13"></td><td><pre>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</pre></td></tr></table></figure><h2 id="参考"><a class="markdownIt-Anchor" href="#参考">#</a> 参考</h2><p><a href="https://opstrip.com/2018/12/28/Getting-Letsencrypt-Certificate-with-DNS-TXT/">Letsencrypt 通过 DNS 的 TXT 记录来验证域名有效性</a><br><a href="https://github.com/al-one/certbot-auth-dnspod/"> Certbot DNS Authenticator For DNSPod</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;使用duck-dns获取lets-encrypt证书&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#使用duck-dns获取lets-encrypt证书&quot;&gt;#&lt;/a&gt; 使用 Duck DNS 获取 Let’s Encrypt 证书&lt;/h</summary>
      
    
    
    
    
    <category term="https" scheme="https://you9you.github.io/tags/https/"/>
    
    <category term="nginx" scheme="https://you9you.github.io/tags/nginx/"/>
    
    <category term="ddns" scheme="https://you9you.github.io/tags/ddns/"/>
    
    <category term="curl" scheme="https://you9you.github.io/tags/curl/"/>
    
  </entry>
  
  <entry>
    <title>通过oauth2访问synapse服务</title>
    <link href="https://you9you.github.io/20230220/synapse-with-oauth/"/>
    <id>https://you9you.github.io/20230220/synapse-with-oauth/</id>
    <published>2023-02-20T08:22:25.000Z</published>
    <updated>2023-05-20T02:23:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a class="markdownIt-Anchor" href="#环境">#</a> 环境</h1><h2 id="网络环境确保"><a class="markdownIt-Anchor" href="#网络环境确保">#</a> 网络环境确保</h2><ul><li>https (建议，http 未测试)</li><li>用户可访问 <code>synapse</code> 、 <code>nextcloud</code></li><li><code>synapse</code>  可访问 <code>nextcloud</code></li></ul><h3 id="自签名证书问题指定ca文件"><a class="markdownIt-Anchor" href="#自签名证书问题指定ca文件">#</a> 自签名证书问题 (指定 ca 文件)</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># docker</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token parameter variable">-v</span> /data/matrix/ca.pem:/etc/ssl/certs/ca.pem <span class="token parameter variable">-e</span> <span class="token assign-left variable">SSL_CERT_FILE</span><span class="token operator">=</span>/etc/ssl/certs/ca.pem</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># linux</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">SSL_CERT_FILE</span><span class="token operator">=</span>/data/matrix/ca.pem</pre></td></tr></table></figure><h1 id="nextcloud"><a class="markdownIt-Anchor" href="#nextcloud">#</a> nextcloud</h1><h2 id="在nextcloud创建oauth2-client"><a class="markdownIt-Anchor" href="#在nextcloud创建oauth2-client">#</a> 在 nextcloud 创建 OAuth2 Client</h2><p><a href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/oauth2.html">官方文档</a><br> callback:  <code>https://&lt;Synapse Server&gt;/_synapse/client/oidc/callback</code></p><h2 id="synapse配置文件homeserveryaml"><a class="markdownIt-Anchor" href="#synapse配置文件homeserveryaml">#</a> synapse 配置文件 (homeserver.yaml)</h2><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># oidc 选项</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">oidc_providers</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token punctuation">-</span> <span class="token key atrule">idp_id</span><span class="token punctuation">:</span> nextcloud</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">idp_name</span><span class="token punctuation">:</span> Nextcloud</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">#idp_brand: "net.eihei.mastodon"  # optional: styling hint for clients</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">discover</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">issuer</span><span class="token punctuation">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">client_id</span><span class="token punctuation">:</span> &lt;OAuth Client ID<span class="token punctuation">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">client_secret</span><span class="token punctuation">:</span> &lt;OAuth Client Secret<span class="token punctuation">></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">authorization_endpoint</span><span class="token punctuation">:</span> <span class="token string">"https://&lt;Nextcloud Server>/apps/oauth2/authorize"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">token_endpoint</span><span class="token punctuation">:</span> <span class="token string">"https://&lt;Nextcloud Server>/apps/oauth2/api/v1/token"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">userinfo_endpoint</span><span class="token punctuation">:</span> <span class="token string">"https://&lt;Nextcloud Server>/ocs/v2.php/cloud/user?format=json"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">scopes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># nextcloud 尚未实现此功能</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">user_mapping_provider</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token key atrule">config</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token key atrule">subject_claim</span><span class="token punctuation">:</span> <span class="token string">"ocs.data.id"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token key atrule">localpart_template</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; ocs.data.id &#125;&#125;"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token key atrule">display_name_template</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; ocs.data.display-name &#125;&#125;"</span></pre></td></tr></table></figure><h1 id="github"><a class="markdownIt-Anchor" href="#github">#</a> github</h1><h2 id="在github创建oauth2-client"><a class="markdownIt-Anchor" href="#在github创建oauth2-client">#</a> 在 github 创建 OAuth2 Client</h2><p><a href="https://ruanyifeng.com/blog/2019/04/github-oauth.html">阮一峰的网络日志</a><br> callback:  <code>https://&lt;Synapse Server&gt;/_synapse/client/oidc/callback</code></p><h2 id="synapse配置文件homeserveryaml-2"><a class="markdownIt-Anchor" href="#synapse配置文件homeserveryaml-2">#</a> synapse 配置文件 (homeserver.yaml)</h2><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># oidc 选项</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">oidc_providers</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token punctuation">-</span> <span class="token key atrule">idp_id</span><span class="token punctuation">:</span> github</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">idp_name</span><span class="token punctuation">:</span> GitHub</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">idp_brand</span><span class="token punctuation">:</span> <span class="token string">"github"</span>  <span class="token comment"># optional: styling hint for clients</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">discover</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">issuer</span><span class="token punctuation">:</span> <span class="token string">"https://github.com/"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">client_id</span><span class="token punctuation">:</span> &lt;OAuth Client ID<span class="token punctuation">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">client_secret</span><span class="token punctuation">:</span> &lt;OAuth Client Secret<span class="token punctuation">></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">authorization_endpoint</span><span class="token punctuation">:</span> <span class="token string">"https://github.com/login/oauth/authorize"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">token_endpoint</span><span class="token punctuation">:</span> <span class="token string">"https://github.com/login/oauth/access_token"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">userinfo_endpoint</span><span class="token punctuation">:</span> <span class="token string">"https://api.github.com/user"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">scopes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"read:user"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">user_mapping_provider</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token key atrule">config</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token key atrule">subject_claim</span><span class="token punctuation">:</span> <span class="token string">"id"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token key atrule">localpart_template</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; user.login &#125;&#125;"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token key atrule">display_name_template</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; user.name &#125;&#125;"</span></pre></td></tr></table></figure><h1 id="其他"><a class="markdownIt-Anchor" href="#其他">#</a> 其他</h1><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 禁用密码登录</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">password_config</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token key atrule">sso_redirect_options</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">immediate</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">on_welcome_page</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr></table></figure><p>OCS 数据结构</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">'ocs'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">'meta'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">'ok'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token string">'statuscode'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'OK'</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">'data'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token string">'storageLocation'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'youyou'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token string">'lastLogin'</span><span class="token punctuation">:</span> <span class="token number">1676870000000</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token string">'backend'</span><span class="token punctuation">:</span> <span class="token string">'Database'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token string">'subadmin'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Guest'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token string">'quota'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token string">'free'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token string">'used'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token string">'relative'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token string">'quota'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">3</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token string">'avatarScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-federated'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token string">'emailScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-federated'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token string">'additional_mail'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token string">'additional_mailScope'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token string">'displaynameScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-federated'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token string">'phone'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token string">'phoneScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-local'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token string">'addressScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-local'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token string">'website'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token string">'websiteScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-published'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token string">'twitter'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token string">'twitterScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-local'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token string">'organisation'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token string">'organisationScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-local'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token string">'roleScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-local'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token string">'headline'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token string">'headlineScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-local'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token string">'biography'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token string">'biographyScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-local'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token string">'profile_enabled'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token string">'profile_enabledScope'</span><span class="token punctuation">:</span> <span class="token string">'v2-local'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token string">'groups'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            <span class="token string">'language'</span><span class="token punctuation">:</span> <span class="token string">'zh_CN'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token string">'locale'</span><span class="token punctuation">:</span> <span class="token string">'zh_Hans_CN'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token string">'notify_email'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token string">'backendCapabilities'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token string">'setDisplayName'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token string">'setPassword'</span><span class="token punctuation">:</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token string">'display-name'</span><span class="token punctuation">:</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="参考"><a class="markdownIt-Anchor" href="#参考">#</a> 参考</h1><p><a href="https://candinya.com/posts/deploy-mastodon-with-synapse/">联合部署 Mastodon 与 Synapse | 糖菓・部落</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#环境&quot;&gt;#&lt;/a&gt; 环境&lt;/h1&gt;
&lt;h2 id=&quot;网络环境确保&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#网络环境确保&quot;&gt;#&lt;/a&gt; 网络环境确保&lt;/</summary>
      
    
    
    
    
    <category term="synapse" scheme="https://you9you.github.io/tags/synapse/"/>
    
    <category term="oauth2" scheme="https://you9you.github.io/tags/oauth2/"/>
    
    <category term="nextcloud" scheme="https://you9you.github.io/tags/nextcloud/"/>
    
    <category term="github" scheme="https://you9you.github.io/tags/github/"/>
    
    <category term="element" scheme="https://you9you.github.io/tags/element/"/>
    
  </entry>
  
  <entry>
    <title>magisk钱包自封装教程</title>
    <link href="https://you9you.github.io/20230203/miui-eu-pay-magisk/"/>
    <id>https://you9you.github.io/20230203/miui-eu-pay-magisk/</id>
    <published>2023-02-03T06:17:00.000Z</published>
    <updated>2023-02-03T06:20:29.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>以 mix-4-odin-stable-V14.0.1.0.TKMCNXM 为例</p></blockquote><h1 id="下载"><a class="markdownIt-Anchor" href="#下载">#</a> 下载</h1><ul><li><a href="https://xiaomirom.com/download/mix-4-odin-stable-V14.0.1.0.TKMCNXM/">国内 ROM V14.0.1.0.TKMCNXM</a></li><li><a href="https://cdn.52huameng.com/software/MIUI%E5%9B%BD%E9%99%85%E7%89%88%E6%9C%AC%E5%9C%B0%E5%8C%96/%E5%9B%BD%E9%99%85%E7%89%88MIUI%E6%B7%BB%E5%8A%A0%E9%92%B1%E5%8C%85_Magisk%E6%A8%A1%E5%9D%97_%E6%A8%A1%E6%9D%BF_220630.zip">Magisk 钱包模块模板</a></li><li><a href="https://github.com/ssut/payload-dumper-go/releases">payload.bin 解包工具 payload-dumper-go</a></li></ul><h1 id="解包"><a class="markdownIt-Anchor" href="#解包">#</a> 解包</h1><ul><li>将 ROM 解压并提取出文件里的 <code>payload.bin</code></li><li>使用 <code>payload-dumper-go</code>  把 <code>payload.bin</code>  解包并提取出镜像文件 (*.img)</li></ul><blockquote><p>钱包相关文件在 product 分区 (其他版本可能在 system 分区)</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>./payload-dumper-go <span class="token parameter variable">-p</span> product payload.bin</pre></td></tr></table></figure><ul><li>挂载提取出的镜像文件 (windows 可以使用 Diskgenius 挂载)</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> extracted_*</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mkdir</span> product</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> <span class="token function">mount</span> product.img product</pre></td></tr></table></figure><p>所需文件在 <code>./product/app/</code></p><ul><li>复制 <code>MINextpay</code>   <code>MIpay</code>   <code>MITSMClient</code>   <code>UPTsmService</code>  到 <code>Magisk模块模板</code> 压缩包的 <code>/system/app/</code>  下</li></ul><blockquote><p>不同版本的 ROM 文件名可能不一样</p></blockquote><h1 id="使用magisk安装"><a class="markdownIt-Anchor" href="#使用magisk安装">#</a> 使用 magisk 安装</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;以 mix-4-odin-stable-V14.0.1.0.TKMCNXM 为例&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;下载&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#下载&quot;&gt;#&lt;/a&gt; 下载&lt;/h1&gt;</summary>
      
    
    
    
    
    <category term="magisk" scheme="https://you9you.github.io/tags/magisk/"/>
    
    <category term="miui" scheme="https://you9you.github.io/tags/miui/"/>
    
    <category term="eu" scheme="https://you9you.github.io/tags/eu/"/>
    
    <category term="pay" scheme="https://you9you.github.io/tags/pay/"/>
    
  </entry>
  
  <entry>
    <title>Jellyfin 无法获取媒体信息</title>
    <link href="https://you9you.github.io/20220614/jellyfin-unable-to-get-media-info/"/>
    <id>https://you9you.github.io/20220614/jellyfin-unable-to-get-media-info/</id>
    <published>2022-06-13T17:01:00.000Z</published>
    <updated>2022-06-14T10:08:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="现象"><a class="markdownIt-Anchor" href="#现象">#</a> 现象</h2><ul><li>无法通过客户端直接播放，需要转码</li><li>字幕列表没有我添加的外部字幕</li></ul><h2 id="log"><a class="markdownIt-Anchor" href="#log">#</a> Log</h2><pre><code>[2022-06-13 16:56:15.421 +00:00] [ERR] [56] MediaBrowser.Providers.Movies.MovieMetadataService: Error in &quot;ffprobe&quot;MediaBrowser.Common.FfmpegException: ffprobe failed - streams and format are both null.   at MediaBrowser.MediaEncoding.Encoder.MediaEncoder.GetMediaInfoInternal(String inputPath, String primaryPath, MediaProtocol protocol, Boolean extractChapters, String probeSizeArgument, Boolean isAudio, Nullable`1 videoType, Boolean forceEnableLogging, CancellationToken cancellationToken)   at MediaBrowser.MediaEncoding.Encoder.MediaEncoder.GetMediaInfoInternal(String inputPath, String primaryPath, MediaProtocol protocol, Boolean extractChapters, String probeSizeArgument, Boolean isAudio, Nullable`1 videoType, Boolean forceEnableLogging, CancellationToken cancellationToken)   at MediaBrowser.Providers.MediaInfo.MediaInfoResolver.GetExternalStreamsAsync(Video video, Int32 startIndex, IDirectoryService directoryService, Boolean clearCache, CancellationToken cancellationToken)   at MediaBrowser.Providers.MediaInfo.FFProbeVideoInfo.AddExternalSubtitlesAsync(Video video, List`1 currentStreams, MetadataRefreshOptions options, CancellationToken cancellationToken)   at MediaBrowser.Providers.MediaInfo.FFProbeVideoInfo.Fetch(Video video, CancellationToken cancellationToken, MediaInfo mediaInfo, BlurayDiscInfo blurayInfo, MetadataRefreshOptions options)   at MediaBrowser.Providers.MediaInfo.FFProbeVideoInfo.ProbeVideo[T](T item, MetadataRefreshOptions options, CancellationToken cancellationToken)   at MediaBrowser.Providers.Manager.MetadataService`2.RunCustomProvider(ICustomMetadataProvider`1 provider, TItemType item, String logName, MetadataRefreshOptions options, RefreshResult refreshResult, CancellationToken cancellationToken)[2022-06-13 16:56:22.468 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: Starting Library Sync...[2022-06-13 16:56:22.468 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: &quot;LIBRARYSYNC&quot; Added 0 items:  &quot;&quot;[2022-06-13 16:56:22.591 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: &quot;LIBRARYSYNC&quot; Updated 1 items:  &quot;b3542d63898d9493a047ab9ab041d76b&quot;[2022-06-13 16:56:22.591 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: &quot;LIBRARYSYNC&quot; Removed 0 items:  &quot;&quot;[2022-06-13 16:56:22.591 +00:00] [INF] [56] Jellyfin.Plugin.KodiSyncQueue.EntryPoints.LibrarySyncNotification: Finished Library Sync Taking &quot;00:00:00.1225482&quot;</code></pre><h2 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案">#</a> 解决方案</h2><h3 id="清除缓存"><a class="markdownIt-Anchor" href="#清除缓存">#</a> 清除缓存</h3><p>根据日志的标识查找文件 &quot;b3542d63898d9493a047ab9ab041d76b&quot;</p><p><code>/jellyfin/config/metadata/library/b3/b3542d63898d9493a047ab9ab041d76b</code></p><p>将 ass 字幕文件删除</p><h3 id="调整字幕"><a class="markdownIt-Anchor" href="#调整字幕">#</a> 调整字幕</h3><p>使用 <code>Aegisub</code>  格式化 (另存文件即可)</p><h3 id="刷新"><a class="markdownIt-Anchor" href="#刷新">#</a> 刷新</h3><p><code>刷新元数据</code> 即可</p><h2 id="其他问题"><a class="markdownIt-Anchor" href="#其他问题">#</a> 其他问题</h2><blockquote><p>16:9 的视频四周都有黑边</p></blockquote><h3 id="网页版"><a class="markdownIt-Anchor" href="#网页版">#</a> 网页版</h3><p>控制台 - 常规 - 品牌 - 自定义 CSS 代码</p><figure class="highlight css"><figcaption data-lang="CSS"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token selector">.htmlvideoplayer</span> <span class="token punctuation">&#123;</span><span class="token property">height</span><span class="token punctuation">:</span> unset<span class="token important">!important</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="客户端jellyfin-media-player"><a class="markdownIt-Anchor" href="#客户端jellyfin-media-player">#</a> 客户端 (Jellyfin Media Player)</h3><p>设置 - 客户端设置 - Video-Aspect</p><pre><code>zoom</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;现象&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#现象&quot;&gt;#&lt;/a&gt; 现象&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;无法通过客户端直接播放，需要转码&lt;/li&gt;
&lt;li&gt;字幕列表没有我添加的外部字幕&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;log&quot;&gt;</summary>
      
    
    
    
    
    <category term="jellyfin" scheme="https://you9you.github.io/tags/jellyfin/"/>
    
  </entry>
  
  <entry>
    <title>使用Sandboxie把Tencent关起来</title>
    <link href="https://you9you.github.io/20220325/sandboxie-tencent/"/>
    <id>https://you9you.github.io/20220325/sandboxie-tencent/</id>
    <published>2022-03-25T06:32:00.000Z</published>
    <updated>2022-03-25T06:02:27.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2><p><strong>Sandboxie</strong> 是一个<a href="https://zh.wikipedia.org/wiki/%E6%B2%99%E7%9B%92_(%E9%9B%BB%E8%85%A6%E5%AE%89%E5%85%A8)">沙盒</a><a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F">计算机程序</a>，原先由 Ronen Tzur 开发，后被 Invincea 收购。Sandboxie 可以在 32 位及 64 位的、基于<a href="https://zh.wikipedia.org/wiki/Windows_NT"> Windows NT</a> 的系统上执行（如<a href="https://zh.wikipedia.org/wiki/Windows_XP"> Windows XP</a>、<a href="https://zh.wikipedia.org/wiki/Windows_7">Windows 7</a> 等）。它创造了一个类似沙盒的独立作业环境，在其内部运行的程序并不能对硬盘产生永久性的影响。其为一个独立的虚拟环境，可用以测试不受信任的应用程序或上网行为。</p><h2 id="使用教程"><a class="markdownIt-Anchor" href="#使用教程">#</a> 使用教程</h2><ol><li>安装<a href="https://github.com/sandboxie-plus/Sandboxie/releases"> sandboxie-plus</a></li><li>进入微软应用商店网页版找到<a href="https://www.microsoft.com/zh-cn/p/qq%E6%A1%8C%E9%9D%A2%E7%89%88/9nhlgf0zwc5s">较为纯净的 QQ</a>，并复制网址</li><li>进入<a href="https://store.rg-adguard.net/">应用下载站</a></li><li>粘贴网址并搜索</li><li>下载最大的 appx 文件 (<s>Tencent 软件最大的才是本体</s>)</li><li>使用解压软件打开 (zip 格式)</li><li>将里面的 <code>QQ</code>  复制到想放置的目录</li><li>在 sandboxie-plus 中新建沙盒</li><li>右键刚刚创建的沙盒 <code>沙盒内容-&gt;创建快捷方式-&gt;所有文件和文件夹</code> ，找到刚刚放置的 QQ 目录下的 <code>\Bin\QQScLauncher.exe</code>  并点击</li><li>从桌面快捷方式启动即可</li></ol><h2 id="注记"><a class="markdownIt-Anchor" href="#注记">#</a> 注记</h2><p>使用教程以 QQ 为例，其他的产品如果没有 <code>QQProtect.exe</code>  之类需要管理员权限的流氓组件，可以直接在官网下载安装包，并使用 sandboxie-plus 运行安装程序，可以由 <code>沙盒内容-&gt;创建快捷方式-&gt;桌面/程序</code> 创建快捷方式</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;简介&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#简介&quot;&gt;#&lt;/a&gt; 简介&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Sandboxie&lt;/strong&gt; 是一个&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E</summary>
      
    
    
    
    
    <category term="sandboxie" scheme="https://you9you.github.io/tags/sandboxie/"/>
    
    <category term="tencent" scheme="https://you9you.github.io/tags/tencent/"/>
    
    <category term="qq" scheme="https://you9you.github.io/tags/qq/"/>
    
  </entry>
  
  <entry>
    <title>magisk隐藏root方案</title>
    <link href="https://you9you.github.io/20220324/magisk-hide/"/>
    <id>https://you9you.github.io/20220324/magisk-hide/</id>
    <published>2022-03-24T06:32:24.000Z</published>
    <updated>2022-03-24T17:11:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="起因"><a class="markdownIt-Anchor" href="#起因">#</a> 起因</h2><p>Magisk 作者，吴泓霖（John Wu）在他的个人推特上宣布，自己已加入 Android 平台安全团队，很高兴与曾经 “on the other side” 的人一起工作。</p><p>近日，吴泓霖在加入谷歌后首次发声，回应了外界关心的 Magisk 后续维护问题。他表示 Magisk 与 Android 确实有一定冲突，但 Magisk 项目将继续维护，也会参与社区工作，但他本人会受到谷歌的 “额外审查”。</p><p>此外，MagiskHide 将被取消，该功能可以让用户对 App 隐藏 root 权限，从而绕过某些 App 的 root 使用限制。吴泓霖表示，自己可以访问几乎所有的谷歌源代码，因此 MagiskHide 与在谷歌的工作存在利益冲突，因此只能停止该功能，但会保留一小部分基础功能。</p><p>用户将能够分配一个拒绝列表，其中 Magisk 拒绝进一步修改并恢复它所做的所有更改。Magisk 不会 欺骗 / 改变 / 操纵 任何非 Magisk 相关的信号或跟踪来规避任何设备状态检测。</p><h2 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案">#</a> 解决方案</h2><p>Shamiko 模块，由 LSPosed 开发团队开发的 Magisk 模块，能够在 zygisk 开启情况下，也可以使用 MagiskHide。</p><p>在 Magisk 早期的版本中，MagiskHide 可以让用户对 App 隐藏 root 权限，对于某些会检测 root 权限的 App 来说，这一功能十分有用。</p><p>但最近发布的新版 Magisk 中增加了名为 Zygisk 的新功能，就再也无法像以前一样隐藏 root 了，而 Shamiko 模块就可以实现在 Zygisk 开启情况下也能用的 MagiskHide</p><h2 id="使用教程"><a class="markdownIt-Anchor" href="#使用教程">#</a> 使用教程</h2><ol><li>在 magisk 设置里， <code>开启Zygisk</code></li><li>安装<a href="https://github.com/LSPosed/LSPosed.github.io/releases"> Shamiko 模块</a></li><li>通过 <code>配置排除列表</code> 选择需要隐藏的进程</li><li>配置好之后，<strong>关闭</strong> <code>遵守排除列表</code> （开启会导致模块不会对列表生效）</li><li>重启系统即可</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;起因&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#起因&quot;&gt;#&lt;/a&gt; 起因&lt;/h2&gt;
&lt;p&gt;Magisk 作者，吴泓霖（John Wu）在他的个人推特上宣布，自己已加入 Android 平台安全团队，很高兴与曾经 “on the ot</summary>
      
    
    
    
    
    <category term="magisk" scheme="https://you9you.github.io/tags/magisk/"/>
    
  </entry>
  
  <entry>
    <title>java, python互相兼容的chacha20-poly1305</title>
    <link href="https://you9you.github.io/20220317/chacha20-poly1305/"/>
    <id>https://you9you.github.io/20220317/chacha20-poly1305/</id>
    <published>2022-03-17T09:03:31.000Z</published>
    <updated>2022-03-25T11:31:04.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h1><h2 id="chacha20"><a class="markdownIt-Anchor" href="#chacha20">#</a> ChaCha20</h2><p><code>ChaCha</code>  系列流密码，作为 <code>Salsa20</code>  密码的改良版，具有更强的抵抗密码分析攻击的特性， <code>20</code>  表示该算法有 20 轮的加密计算。</p><p>由于是流密码，故以字节为单位进行加密，安全性的关键体现在密钥流生成的过程，即所依赖的 <code>伪随机数</code> 生成器（PRNG）的强度，加密过程即是将密钥流与明文逐字节异或得到密文，反之，解密是将密文再与密钥流做一次异或运算得到明文。</p><h2 id="poly1305消息认证码"><a class="markdownIt-Anchor" href="#poly1305消息认证码">#</a> Poly1305 消息认证码</h2><p><code>消息认证码</code> （带密钥的 <code>Hash函数</code> ）: 密码学中，通信实体双方使用的一种验证机制，保证消息 <code>数据完整性</code> 的一种工具。构造方法由<em> M.Bellare</em> 提出，安全性依赖于 Hash 函数，故也称带密钥的 Hash 函数。消息认证码是基于密钥和消息摘要所获得的一个值，可用于数据源发认证和完整性校验。</p><p><code>Poly1305</code>  是<em> Daniel.J.Bernstein</em> 创建的消息认证码，可用于检测消息的完整性和验证消息的真实性，现常在网络安全协议（SSL/TLS）中与 <code>Salsa20</code>  或 <code>ChaCha20</code>  流密码结合使用。</p><p><code>Poly1305</code>  消息认证码的输入为 32 字节（256bit）的密钥和任意长度的消息比特流，经过一系列计算生成 16 字节（128bit）的摘要。</p><h1 id="源代码"><a class="markdownIt-Anchor" href="#源代码">#</a> 源代码</h1><h2 id="java"><a class="markdownIt-Anchor" href="#java">#</a> java</h2><blockquote><p>crypto 库默认加密后的结构为 ciphertext + tag</p></blockquote><p><em><strong>ChaCha20Poly1305.java</strong></em></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">GeneralSecurityException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">InvalidAlgorithmParameterException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">InvalidKeyException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">SecureRandom</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">AlgorithmParameterSpec</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Cipher</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">KeyGenerator</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">NoSuchPaddingException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">IvParameterSpec</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">SecretKeySpec</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChaCha20Poly1305</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ENCRYPT_ALGO</span> <span class="token operator">=</span> <span class="token string">"ChaCha20-Poly1305/None/NoPadding"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> header<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">throws</span> <span class="token class-name">GeneralSecurityException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonceBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextBytes</span><span class="token punctuation">(</span>nonceBytes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">,</span> nonceBytes<span class="token punctuation">,</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">hex2bytes</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> jsonMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        jsonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nonce"</span><span class="token punctuation">,</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">bytes2hex</span><span class="token punctuation">(</span>nonceBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        jsonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">,</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">bytes2hex</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        jsonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">bytes2hex</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">return</span> jsonMap<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">decrypt2String</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonce<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">AAD</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherData<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token keyword">throws</span> <span class="token class-name">GeneralSecurityException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decryptedText <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>cipherData<span class="token punctuation">,</span> key<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> <span class="token constant">AAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decryptedText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt2Bytes</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonce<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">AAD</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherData<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token keyword">throws</span> <span class="token class-name">GeneralSecurityException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decryptedText <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>cipherData<span class="token punctuation">,</span> key<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> <span class="token constant">AAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token keyword">return</span> decryptedText<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonceBytes<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">AAD</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token keyword">throws</span> <span class="token class-name">GeneralSecurityException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token comment">// Get Cipher Instance</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token constant">ENCRYPT_ALGO</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token comment">// Create IvParamterSpec</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token class-name">AlgorithmParameterSpec</span> ivParameterSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IvParameterSpec</span><span class="token punctuation">(</span>nonceBytes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token comment">// Create SecretKeySpec</span></pre></td></tr><tr><td data-num="65"></td><td><pre>            <span class="token class-name">SecretKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">ENCRYPT_ALGO</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token comment">// Initialize Cipher for ENCRYPT_MODE</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token constant">ENCRYPT_MODE</span><span class="token punctuation">,</span> keySpec<span class="token punctuation">,</span> ivParameterSpec<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>            cipher<span class="token punctuation">.</span><span class="token function">updateAAD</span><span class="token punctuation">(</span><span class="token constant">AAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre>            <span class="token comment">// Perform Encryption</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre>            <span class="token keyword">return</span> cipherText<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> <span class="token operator">|</span> <span class="token class-name">NoSuchPaddingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidKeyException</span> <span class="token operator">|</span> <span class="token class-name">InvalidAlgorithmParameterException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonceBytes<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">AAD</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            <span class="token keyword">throws</span> <span class="token class-name">GeneralSecurityException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            <span class="token comment">// Get Cipher Instance</span></pre></td></tr><tr><td data-num="87"></td><td><pre>            <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token constant">ENCRYPT_ALGO</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token comment">// Create IvParamterSpec</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token class-name">AlgorithmParameterSpec</span> ivParameterSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IvParameterSpec</span><span class="token punctuation">(</span>nonceBytes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre>            <span class="token comment">// Create SecretKeySpec</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            <span class="token class-name">SecretKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">ENCRYPT_ALGO</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre>            <span class="token comment">// Initialize Cipher for DECRYPT_MODE</span></pre></td></tr><tr><td data-num="96"></td><td><pre>            cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token constant">DECRYPT_MODE</span><span class="token punctuation">,</span> keySpec<span class="token punctuation">,</span> ivParameterSpec<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre>            cipher<span class="token punctuation">.</span><span class="token function">updateAAD</span><span class="token punctuation">(</span><span class="token constant">AAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre></pre></td></tr><tr><td data-num="100"></td><td><pre>            <span class="token comment">// Perform Decryption</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decryptedText <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre>            <span class="token keyword">return</span> decryptedText<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> <span class="token operator">|</span> <span class="token class-name">NoSuchPaddingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidKeyException</span> <span class="token operator">|</span> <span class="token class-name">InvalidAlgorithmParameterException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="110"></td><td><pre></pre></td></tr><tr><td data-num="111"></td><td><pre>    <span class="token comment">/**</pre></td></tr><tr><td data-num="112"></td><td><pre>     * 生成 ChaCha20 密钥 (256bit)</pre></td></tr><tr><td data-num="113"></td><td><pre>     * </pre></td></tr><tr><td data-num="114"></td><td><pre>     * @return</pre></td></tr><tr><td data-num="115"></td><td><pre>     * @throws NoSuchAlgorithmException</pre></td></tr><tr><td data-num="116"></td><td><pre>     */</span></pre></td></tr><tr><td data-num="117"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token class-name">KeyGenerator</span> keyGen <span class="token operator">=</span> <span class="token class-name">KeyGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token constant">ENCRYPT_ALGO</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>        keyGen<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">.</span><span class="token function">getInstanceStrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>        <span class="token keyword">return</span> keyGen<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="122"></td><td><pre></pre></td></tr><tr><td data-num="123"></td><td><pre>    <span class="token comment">/**</pre></td></tr><tr><td data-num="124"></td><td><pre>     * 测试</pre></td></tr><tr><td data-num="125"></td><td><pre>     * @throws Exception</pre></td></tr><tr><td data-num="126"></td><td><pre>     */</span></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="128"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ChaCha20Poly1305Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>        <span class="token class-name">String</span> plaintext <span class="token operator">=</span> <span class="token string">"ChaCha20Poly1305Test"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre></pre></td></tr><tr><td data-num="131"></td><td><pre>        <span class="token class-name">KeyGenerator</span> keyGen <span class="token operator">=</span> <span class="token class-name">KeyGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"ChaCha20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>        keyGen<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">.</span><span class="token function">getInstanceStrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre></pre></td></tr><tr><td data-num="134"></td><td><pre>        <span class="token class-name">SecretKey</span> key <span class="token operator">=</span> keyGen<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre></pre></td></tr><tr><td data-num="136"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonceBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>        <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextBytes</span><span class="token punctuation">(</span>nonceBytes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="138"></td><td><pre></pre></td></tr><tr><td data-num="139"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">AAD</span> <span class="token operator">=</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">hex2bytes</span><span class="token punctuation">(</span><span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre></pre></td></tr><tr><td data-num="141"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext <span class="token operator">=</span> <span class="token class-name">ChaCha20Poly1305</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nonceBytes<span class="token punctuation">,</span> <span class="token constant">AAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>        <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token class-name">ChaCha20Poly1305</span><span class="token punctuation">.</span><span class="token function">decrypt2String</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nonceBytes<span class="token punctuation">,</span> <span class="token constant">AAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="143"></td><td><pre></pre></td></tr><tr><td data-num="144"></td><td><pre>        <span class="token function">assertEquals</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="146"></td><td><pre>     </pre></td></tr><tr><td data-num="147"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><em><strong>Utils.java</strong></em></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigInteger</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">MessageDigest</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Utils</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hash<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            hash <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"NoSuchAlgorithmException"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">bytes2hex</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">/**</pre></td></tr><tr><td data-num="18"></td><td><pre>     * </pre></td></tr><tr><td data-num="19"></td><td><pre>     * @param bytes the byte []</pre></td></tr><tr><td data-num="20"></td><td><pre>     * @return the hex string</pre></td></tr><tr><td data-num="21"></td><td><pre>     */</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">bytes2hex</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">/**</pre></td></tr><tr><td data-num="27"></td><td><pre>     * To byte array byte [ ].</pre></td></tr><tr><td data-num="28"></td><td><pre>     *</pre></td></tr><tr><td data-num="29"></td><td><pre>     * @param hexString the hex string</pre></td></tr><tr><td data-num="30"></td><td><pre>     * @return the byte []</pre></td></tr><tr><td data-num="31"></td><td><pre>     */</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">hex2bytes</span><span class="token punctuation">(</span><span class="token class-name">String</span> hex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        hex <span class="token operator">=</span> hex<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">"0"</span> <span class="token operator">+</span> hex <span class="token operator">:</span> hex<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>hex<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token keyword">int</span> index <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token keyword">int</span> v <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>hex<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> v<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">return</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment">/**</pre></td></tr><tr><td data-num="46"></td><td><pre>     * 合并数组 System.arraycopy ()</pre></td></tr><tr><td data-num="47"></td><td><pre>     * </pre></td></tr><tr><td data-num="48"></td><td><pre>     * @param byte1</pre></td></tr><tr><td data-num="49"></td><td><pre>     * @param byte2</pre></td></tr><tr><td data-num="50"></td><td><pre>     * @return</pre></td></tr><tr><td data-num="51"></td><td><pre>     */</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">byteMerger</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> byte1<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> byte2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> byte3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>byte1<span class="token punctuation">.</span>length <span class="token operator">+</span> byte2<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>byte1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> byte3<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> byte1<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>byte2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> byte3<span class="token punctuation">,</span> byte1<span class="token punctuation">.</span>length<span class="token punctuation">,</span> byte2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">return</span> byte3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="python"><a class="markdownIt-Anchor" href="#python">#</a> python</h2><blockquote><p>pycryptodome 库默认加密后的结构为 ciphertext, tag</p></blockquote><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># pip install pycryptodome</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> ChaCha20_Poly1305</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Random <span class="token keyword">import</span> get_random_bytes</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">chacha20_poly1305_en_func</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> associatedData<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">#header = b"header"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">#plaintext = b'Attack at dawn'</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">#key = get_random_bytes(32)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    cipher <span class="token operator">=</span> ChaCha20_Poly1305<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token operator">=</span>key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    cipher<span class="token punctuation">.</span>update<span class="token punctuation">(</span>associatedData<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    ciphertext<span class="token punctuation">,</span> tag <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt_and_digest<span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">return</span> cipher<span class="token punctuation">.</span>nonce<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ciphertext <span class="token operator">+</span> tag<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">def</span> <span class="token function">chacha20_poly1305_de_func</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> nonce<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> associatedData<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> tag<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    cipher <span class="token operator">=</span> ChaCha20_Poly1305<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token operator">=</span>key<span class="token punctuation">,</span> nonce<span class="token operator">=</span>nonce<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    cipher<span class="token punctuation">.</span>update<span class="token punctuation">(</span>associatedData<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    plaintext <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt_and_verify<span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> tag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">return</span> plaintext</pre></td></tr></table></figure><h1 id="注记"><a class="markdownIt-Anchor" href="#注记">#</a> 注记</h1><p>加密库处理结果为 byte/byte []，需要编码 / 解码（base64/hex）才能互相识别</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;简介&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#简介&quot;&gt;#&lt;/a&gt; 简介&lt;/h1&gt;
&lt;h2 id=&quot;chacha20&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#chacha20&quot;&gt;#&lt;/a&gt; ChaC</summary>
      
    
    
    
    
    <category term="chacha20-poly1305" scheme="https://you9you.github.io/tags/chacha20-poly1305/"/>
    
  </entry>
  
  <entry>
    <title>通过隧道使用受限网络的思路</title>
    <link href="https://you9you.github.io/20220203/tunnel/"/>
    <id>https://you9you.github.io/20220203/tunnel/</id>
    <published>2022-02-03T13:53:00.000Z</published>
    <updated>2022-03-24T07:17:33.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="wireguard"><a class="markdownIt-Anchor" href="#wireguard">#</a> <a href="https://www.wireguard.com/">WireGuard</a></h2><blockquote><p><strong>WireGuard</strong> 是由 Jason A. Donenfeld 开发的<a href="https://zh.wikipedia.org/wiki/%E5%BC%80%E6%94%BE%E6%BA%90%E4%BB%A3%E7%A0%81">开放源代码</a><a href="https://zh.wikipedia.org/wiki/%E8%99%9B%E6%93%AC%E7%A7%81%E4%BA%BA%E7%B6%B2%E8%B7%AF"> VPN</a> 程序及协议，基于<a href="https://zh.wikipedia.org/wiki/Linux%E5%86%85%E6%A0%B8"> Linux 内核</a>实现，利用<a href="https://zh.wikipedia.org/wiki/Curve25519"> Curve25519</a> 进行密钥交换，<a href="https://zh.wikipedia.org/wiki/ChaCha20">ChaCha20</a> 用于加密，<a href="https://zh.wikipedia.org/wiki/Poly1305">Poly1305</a> 用于数据认证，<a href="https://zh.wikipedia.org/wiki/BLAKE2">BLAKE2</a> 用于<a href="https://zh.wikipedia.org/wiki/%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B8">散列函数</a>运算，支持<a href="https://zh.wikipedia.org/wiki/IPv4"> IPv4</a> 和<a href="https://zh.wikipedia.org/wiki/IPv6"> IPv6</a> 的第 3 层。WireGuard 旨在获得比<a href="https://zh.wikipedia.org/wiki/IPsec"> IPsec</a> 和<a href="https://zh.wikipedia.org/wiki/OpenVPN"> OpenVPN</a> 更好的性能。</p></blockquote><p>由于具有较高的性能，在没有任何检测机制的网络下，可以具有较高的体验</p><h2 id="openvpn"><a class="markdownIt-Anchor" href="#openvpn">#</a> <a href="https://openvpn.net/">OpenVPN</a></h2><blockquote><p><strong>OpenVPN</strong> 是一个用于创建<a href="https://zh.wikipedia.org/wiki/%E8%99%9A%E6%8B%9F%E7%A7%81%E4%BA%BA%E7%BD%91%E7%BB%9C">虚拟私人网络</a>加密通道的软件包，最早由 James Yonan 编写。OpenVPN 允许创建的 VPN 使用<a href="https://zh.wikipedia.org/wiki/%E5%85%AC%E5%BC%80%E5%AF%86%E9%92%A5">公开密钥</a>、<a href="https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%AD%90%E8%AD%89%E6%9B%B8">电子证书</a>、或者用户名／密码来进行身份验证。</p><p>它大量使用了<a href="https://zh.wikipedia.org/wiki/OpenSSL"> OpenSSL</a> 加密库中的<a href="https://zh.wikipedia.org/wiki/SSL"> SSL</a>/<a href="https://zh.wikipedia.org/wiki/TLS">TLS</a> 协议函数库。</p><p>目前 OpenVPN 能在<a href="https://zh.wikipedia.org/wiki/Solaris"> Solaris</a>、<a href="https://zh.wikipedia.org/wiki/Linux">Linux</a>、<a href="https://zh.wikipedia.org/wiki/OpenBSD">OpenBSD</a>、<a href="https://zh.wikipedia.org/wiki/FreeBSD">FreeBSD</a>、<a href="https://zh.wikipedia.org/wiki/NetBSD">NetBSD</a>、<a href="https://zh.wikipedia.org/wiki/Mac_OS_X">Mac OS X</a> 与<a href="https://zh.wikipedia.org/wiki/Microsoft_Windows"> Microsoft Windows</a> 以及<a href="https://zh.wikipedia.org/wiki/Android"> Android</a> 和<a href="https://zh.wikipedia.org/wiki/IOS"> iOS</a> 上运行，并包含了许多安全性的功能。它不与<a href="https://zh.wikipedia.org/wiki/IPsec"> IPsec</a> 兼容。</p></blockquote><p>通过<a href="https://www.softether.org/"> SoftEther VPN Project</a> 是一个支持多协议的服务软件，可以快速的搭建服务</p><p>并且可以在只允许 dns (udp/53) 数据通过的情况下使用</p><h2 id="shadowsocks"><a class="markdownIt-Anchor" href="#shadowsocks">#</a> <a href="https://shadowsocks.org/">Shadowsocks</a></h2><blockquote><p><strong>Shadowsocks</strong>（简称<strong> SS</strong>）是一种基于<a href="https://zh.wikipedia.org/wiki/SOCKS#SOCK5"> Socks5</a> 代理方式的加密传输协议，也可以指实现这个协议的各种开发包。目前包使用<a href="https://zh.wikipedia.org/wiki/Python"> Python</a>、<a href="https://zh.wikipedia.org/wiki/C%E8%AA%9E%E8%A8%80">C</a>、<a href="https://zh.wikipedia.org/wiki/C%2B%2B">C++</a>、<a href="https://zh.wikipedia.org/wiki/C%E2%99%AF">C#</a>、<a href="https://zh.wikipedia.org/wiki/Go%E8%AF%AD%E8%A8%80">Go 语言</a>、<a href="https://zh.wikipedia.org/wiki/Rust">Rust</a> 等编程语言开发，大部分主要实现（<a href="https://zh.wikipedia.org/wiki/IOS">iOS</a> 平台的除外）采用<a href="https://zh.wikipedia.org/wiki/Apache%E8%AE%B8%E5%8F%AF%E8%AF%81"> Apache 许可证</a>、<a href="https://zh.wikipedia.org/wiki/GPL">GPL</a>、<a href="https://zh.wikipedia.org/wiki/MIT%E8%A8%B1%E5%8F%AF%E8%AD%89">MIT 许可证</a>等多种<a href="https://zh.wikipedia.org/wiki/%E8%87%AA%E7%94%B1%E8%BB%9F%E9%AB%94">自由软件</a>许可协议<a href="https://zh.wikipedia.org/wiki/%E9%96%8B%E6%94%BE%E5%8E%9F%E5%A7%8B%E7%A2%BC">开放源代码</a>。Shadowsocks 分为服务器端和客户端，在使用之前，需要先将服务器端程序部署到服务器上面，然后通过客户端连接并创建本地代理。</p></blockquote><p>协议及软件持续更新 (相对 ssr)，占用内存较低 (相对 vmess)，可以使用低配置的 Linux 虚拟机 (512MB 内存 / 1 核)</p><p>在一下会<strong>共享 IP 检测</strong>，<strong>DHCP 检测 VPN</strong> 的网络下，使用搭载 Shadowsocks 的 Linux 虚拟机 (虚拟机配置为桥接网络)，会有绝佳的效果</p><p>其他说明：游戏用户须开启 udp</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;wireguard&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#wireguard&quot;&gt;#&lt;/a&gt; &lt;a href=&quot;https://www.wireguard.com/&quot;&gt;WireGuard&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;</summary>
      
    
    
    
    
    <category term="network" scheme="https://you9you.github.io/tags/network/"/>
    
    <category term="tunnel" scheme="https://you9you.github.io/tags/tunnel/"/>
    
    <category term="wireguard" scheme="https://you9you.github.io/tags/wireguard/"/>
    
    <category term="openvpn" scheme="https://you9you.github.io/tags/openvpn/"/>
    
  </entry>
  
  <entry>
    <title>网络故障排错思路</title>
    <link href="https://you9you.github.io/20220121/network-check/"/>
    <id>https://you9you.github.io/20220121/network-check/</id>
    <published>2022-01-21T07:41:24.000Z</published>
    <updated>2023-05-20T02:26:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="主体思路"><a class="markdownIt-Anchor" href="#主体思路">#</a> 主体思路</h2><ul><li><p>检查物理链路</p></li><li><p>查看本机 IP 地址、路由、DNS 的设置；</p></li><li><p>测试网关或路由器的通畅情况。先测网关然后再测路由器，一级一级地测试；</p></li><li><p>测试 ping 公网 IP 的通畅情况</p></li><li><p>测试 DNS 的通畅情况</p></li></ul><h2 id="windows控制面板"><a class="markdownIt-Anchor" href="#windows控制面板">#</a> Windows 控制面板</h2><blockquote><p>控制面板 - 网络和 Internet - 网络连接</p></blockquote><p>可能的情况:</p><h3 id="一片空白"><a class="markdownIt-Anchor" href="#一片空白">#</a> <s>一片空白</s></h3><blockquote><p>没有网卡 / 没装驱动</p></blockquote><h3 id="网络电缆被拔出"><a class="markdownIt-Anchor" href="#网络电缆被拔出">#</a> 网络电缆被拔出</h3><blockquote><p>检查物理链路</p></blockquote><h3 id="未识别的网络"><a class="markdownIt-Anchor" href="#未识别的网络">#</a> 未识别的网络</h3><blockquote><p>没有 IP 地址 / 网关配置错误</p><p>检查 DHCP 服务器设置</p></blockquote><h3 id="网络"><a class="markdownIt-Anchor" href="#网络">#</a> 网络 *</h3><blockquote><p>正常网络 (不包括 DNS)</p></blockquote><h2 id="非底层错误方案"><a class="markdownIt-Anchor" href="#非底层错误方案">#</a> 非底层错误方案</h2><h3 id="检查本地环回"><a class="markdownIt-Anchor" href="#检查本地环回">#</a> 检查本地环回</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ping</span> <span class="token number">127.0</span>.0.1</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 正在 Ping 127.0.0.1 具有 32 字节的数据:</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 来自 127.0.0.1 的回复：字节 = 32 时间 & lt;1ms TTL=128</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 来自 127.0.0.1 的回复：字节 = 32 时间 & lt;1ms TTL=128</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 来自 127.0.0.1 的回复：字节 = 32 时间 & lt;1ms TTL=128</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 来自 127.0.0.1 的回复：字节 = 32 时间 & lt;1ms TTL=128</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># </span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 127.0.0.1 的 Ping 统计信息:</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#     数据包：已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 往返行程的估计时间 (以毫秒为单位):</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#     最短 = 0ms，最长 = 0ms，平均 = 0ms</span></pre></td></tr></table></figure><blockquote><p>如果超时或者其他问题，建议使用’官方镜像’重装系统</p></blockquote><h2 id="查看ip配置"><a class="markdownIt-Anchor" href="#查看ip配置">#</a> 查看 IP 配置</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ipconfig /all</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 以太网适配器 以太网:</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#    连接特定的 DNS 后缀 . . . . . . . : lan</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#    描述. . . . . . . . . . . . . . . : Realtek PCIe GbE Family Controller</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#    物理地址. . . . . . . . . . . . . : ***</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#    DHCP 已启用 . . . . . . . . . . . : 是</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#    IPv4 地址 . . . . . . . . . . . . : 192.168.1.**(首选)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#    子网掩码  . . . . . . . . . . . . : 255.255.255.0</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">#    获得租约的时间  . . . . . . . . . : 2022 年 1 月 21 日 15:44:36</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#    租约过期的时间  . . . . . . . . . : 2022 年 1 月 22 日 15:44:35</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">#    默认网关. . . . . . . . . . . . . : 192.168.1.1</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">#    DHCP 服务器 . . . . . . . . . . . : 192.168.1.1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">#    DNS 服务器  . . . . . . . . . . . : 192.168.1.10</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#    TCPIP 上的 NetBIOS  . . . . . . . : 已启用</span></pre></td></tr></table></figure><blockquote><p>如果 IPv4 地址为 169.254.*.*</p><p>检查 DHCP 服务器设置</p></blockquote><h3 id="尝试使用ping测试网关-dns服务器的连通性"><a class="markdownIt-Anchor" href="#尝试使用ping测试网关-dns服务器的连通性">#</a> 尝试使用 ping 测试网关、DNS 服务器的连通性</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ping</span> <span class="token operator">&lt;</span>gateway<span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># ping 192.168.1.1</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">ping</span> <span class="token operator">&lt;</span>dns<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># ping 192.168.1.10</span></pre></td></tr></table></figure><h3 id="尝试使用ping测试公共服务器的连通性"><a class="markdownIt-Anchor" href="#尝试使用ping测试公共服务器的连通性">#</a> 尝试使用 ping 测试公共服务器的连通性</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ping</span> <span class="token number">223.5</span>.5.5</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># ali DNS</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">ping</span> <span class="token number">114.114</span>.114.114</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 114 DNS</span></pre></td></tr></table></figure><h3 id="尝试使用nslookup测试域名解析"><a class="markdownIt-Anchor" href="#尝试使用nslookup测试域名解析">#</a> 尝试使用 nslookup 测试域名解析</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">nslookup</span> <span class="token operator">&lt;</span>domain.com<span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># nslookup baidu.com</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 使用系统设置的 DNS 进行解析</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">nslookup</span> <span class="token operator">&lt;</span>domain.com<span class="token operator">></span> <span class="token operator">&lt;</span>DNS Server<span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># nslookup baidu.com 223.5.5.5</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 指定 DNS 服务器进行解析</span></pre></td></tr></table></figure><h3 id="尝试使用ping测试域名解析"><a class="markdownIt-Anchor" href="#尝试使用ping测试域名解析">#</a> 尝试使用 ping 测试域名解析</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ping</span> <span class="token operator">&lt;</span>domain.com<span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># ping baidu.com</span></pre></td></tr></table></figure><blockquote><p>如果使用’nslookup’测试正常，但 ping 无法连通，检查’hosts’文件</p></blockquote><h3 id="尝试使用curl测试http"><a class="markdownIt-Anchor" href="#尝试使用curl测试http">#</a> 尝试使用 curl 测试 HTTP</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-v</span> <span class="token operator">&lt;</span>http_20<span class="token operator"><span class="token file-descriptor important">4</span>></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># curl -v http://connectivitycheck.gstatic.com/generate_204</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># [gstatic.com] http://connectivitycheck.gstatic.com/generate_204</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># [google.cn] http://www.google.cn/generate_204</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># [miui.com] http://connect.rom.miui.com/generate_204</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># [hicloud.com] http://connectivitycheck.platform.hicloud.com/generate_204</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># *   Trying ***:80...</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># * Connected to connectivitycheck.gstatic.com (***) port 80 (#0)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># > GET /generate_204 HTTP/1.1</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># > Host: connectivitycheck.gstatic.com</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># > User-Agent: curl/7.79.1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># > Accept: */*</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># ></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># * Mark bundle as not supporting multiuse</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># &lt; HTTP/1.1 204 No Content</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># &lt; Content-Length: 0</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># &lt; Date: Fri, 21 Jan 2022 08:09:26 GMT</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># &lt;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># * Connection #0 to host connectivitycheck.gstatic.com left intact</span></pre></td></tr></table></figure><blockquote><p>关键字: 204 No Content</p></blockquote><h2 id="windows-互联网检测基准"><a class="markdownIt-Anchor" href="#windows-互联网检测基准">#</a> Windows 互联网检测基准</h2><p><a href="http://www.msftconnecttest.com/connecttest.txt">http://www.msftconnecttest.com/connecttest.txt</a></p><pre><code>Microsoft Connect Test</code></pre><p><a href="http://www.msftncsi.com/ncsi.txt">http://www.msftncsi.com/ncsi.txt</a></p><pre><code>Microsoft NCSI</code></pre><p>dns://dns.msftncsi.com</p><pre><code>fd3e:4f5a:5b81::1131.107.255.255</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;主体思路&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#主体思路&quot;&gt;#&lt;/a&gt; 主体思路&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;检查物理链路&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查看本机 IP 地址、路由、DNS 的设置；&lt;/p&gt;
&lt;/l</summary>
      
    
    
    
    
    <category term="curl" scheme="https://you9you.github.io/tags/curl/"/>
    
    <category term="network" scheme="https://you9you.github.io/tags/network/"/>
    
    <category term="ping" scheme="https://you9you.github.io/tags/ping/"/>
    
    <category term="nslookup" scheme="https://you9you.github.io/tags/nslookup/"/>
    
  </entry>
  
  <entry>
    <title>teamspeak</title>
    <link href="https://you9you.github.io/20220120/teamspeak/"/>
    <id>https://you9you.github.io/20220120/teamspeak/</id>
    <published>2022-01-20T09:03:31.000Z</published>
    <updated>2022-01-20T09:54:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装包"><a class="markdownIt-Anchor" href="#安装包">#</a> 安装包</h2><ul><li>官方 [<a href="https://www.teamspeak.com/zh-CN/downloads/">https://www.teamspeak.com/zh-CN/downloads/</a>]</li><li>虎符电竞 [<a href="https://ts.zhaoq.me/">https://ts.zhaoq.me/</a>]</li><li><s>国内定制 [<a href="http://www.ts1.cn/download">http://www.ts1.cn/download</a>]</s></li></ul><h2 id="插件"><a class="markdownIt-Anchor" href="#插件">#</a> 插件</h2><ul><li>简体中文 [<a href="https://github.com/jitingcn/TS3-Translation_zh-CN/releases">https://github.com/jitingcn/TS3-Translation_zh-CN/releases</a>]</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;安装包&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#安装包&quot;&gt;#&lt;/a&gt; 安装包&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;官方 [&lt;a href=&quot;https://www.teamspeak.com/zh-CN/downloads/&quot;&gt;https</summary>
      
    
    
    
    
    <category term="teamspeak" scheme="https://you9you.github.io/tags/teamspeak/"/>
    
  </entry>
  
</feed>
